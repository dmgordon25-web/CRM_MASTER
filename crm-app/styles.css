@import url("./css/tokens.css");
@import url("./css/relationships.css");

:root{
  --bg:var(--surface-background);
  --panel:var(--surface-panel);
  --ink:var(--text-primary);
  --muted:var(--text-muted);
  --brand:var(--primary);
  --ring:var(--focus-ring);
  --ok:var(--accent-task);
  --ok-soft:var(--accent-success);
  --warn:#f59e0b;
  --bad:#dc2626;
  --btn-shadow:0 2px 6px rgba(15,23,42,0.08);
  --btn-shadow-hover:0 8px 20px rgba(15,23,42,0.16);
  --fab-safe-bottom:clamp(12px,env(safe-area-inset-bottom) + 16px,32px);
  --stage-new:#dbeafe;
  --stage-qualified:#ede9fe;
  --stage-negotiating:#fef3c7;
  --stage-ctc:#dcfce7;
  --stage-won:#bbf7d0;
  --stage-lost:#fee2e2;
  --tone-progress-bg:var(--stage-new);
  --tone-progress-border:#bfdbfe;
  --tone-progress-text:#1d4ed8;
  --tone-success-bg:var(--stage-ctc);
  --tone-success-border:#86efac;
  --tone-success-text:#166534;
  --tone-warning-bg:var(--stage-negotiating);
  --tone-warning-border:#fcd34d;
  --tone-warning-text:#92400e;
  --tone-danger-bg:var(--stage-lost);
  --tone-danger-border:#fca5a5;
  --tone-danger-text:#b91c1c;
}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:var(--font-family-sans);font-size:var(--body-font-size);line-height:var(--line-height-base);letter-spacing:var(--letter-spacing-normal);min-height:100vh;overflow-y:auto;}
.container{max-width:1360px;margin:0 auto;padding:0 var(--space-5) var(--space-5);}
.top-shell{position:sticky;top:0;z-index:120;background:var(--bg);padding:var(--space-5) 0 var(--space-4);margin-bottom:var(--space-5);border-bottom:1px solid rgba(148,163,184,.28);box-shadow:0 18px 36px rgba(15,23,42,.08);}
.help-hint{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:999px;background:rgba(148,163,184,0.18);color:var(--muted);font-size:12px;line-height:1;font-weight:600;cursor:help;transition:background .2s ease,color .2s ease;user-select:none;}
.help-hint:hover,.help-hint:focus{background:rgba(37,99,235,0.18);color:#1d4ed8;}
.help-hint:focus-visible{outline:2px solid var(--focus-ring,#2563eb);outline-offset:2px;}
.btn.subtle{background:rgba(148,163,184,0.12);color:var(--muted);box-shadow:none;border:1px solid rgba(148,163,184,0.25);}
.btn.subtle:hover{color:#1f2937;background:rgba(148,163,184,0.2);}
.btn.subtle[aria-pressed="true"]{background:rgba(37,99,235,0.16);color:#1d4ed8;border-color:rgba(37,99,235,0.35);}
header{display:flex;align-items:center;gap:var(--space-3);flex-wrap:wrap}
h1{margin:0;font-size:var(--font-size-xl);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);font-weight:700}
h2{margin:0;font-size:var(--font-size-lg);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);font-weight:700}
h3{margin:0;font-size:var(--font-size-base);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-tight);font-weight:600}
h4{margin:0;font-size:var(--font-size-sm);line-height:var(--line-height-snug);letter-spacing:var(--letter-spacing-wide);font-weight:600;color:var(--muted)}
.heading-sm{font-size:var(--font-size-sm);font-weight:600;letter-spacing:var(--letter-spacing-tight);line-height:var(--line-height-snug);color:var(--muted);text-transform:uppercase}
.heading-base{font-size:var(--font-size-base);font-weight:600;letter-spacing:var(--letter-spacing-tight);line-height:var(--line-height-snug)}
.heading-lg{font-size:var(--font-size-lg);font-weight:700;letter-spacing:var(--letter-spacing-tight);line-height:var(--line-height-snug)}
.app-title,.filter-options input[type="checkbox"]{margin:0}
.title-link{display:flex;flex-direction:column;gap:var(--space-1);text-decoration:none;color:inherit;cursor:pointer;border-radius:var(--radius-md);padding:var(--space-1) var(--space-2);transition:background-color .2s ease,color .2s ease;}
.title-link:hover .title-main,.title-sub.accent{color:var(--brand)}
.title-link:focus-visible{outline:2px solid var(--ring);outline-offset:2px}
.title-main{font-size:var(--font-size-2xl);font-weight:800;letter-spacing:var(--letter-spacing-tight);line-height:var(--line-height-tight);}
.title-sub{font-size:var(--font-size-xs);font-weight:600;letter-spacing:var(--letter-spacing-wide);text-transform:uppercase;color:var(--muted)}
.badge{color:var(--muted);font-weight:600;font-size:var(--font-size-sm);letter-spacing:var(--letter-spacing-wide)}
.tap-44{min-width:var(--tap-target-size);min-height:var(--tap-target-size)}

:where(button,[role="button"],.btn){min-width:var(--tap-target-size);min-height:var(--tap-target-size)}

:where(a[href],button,[role="button"],input,select,textarea):focus-visible,:where(.focus-visible){outline:2px solid var(--ring);outline-offset:3px}

.focus-ring{outline:2px solid var(--ring);outline-offset:3px}

.btn{appearance:none;border:1px solid var(--button-secondary-border);background:var(--button-secondary-bg);color:var(--button-secondary-text);padding:0 var(--button-spacing-x);border-radius:var(--button-radius);cursor:pointer;transition:background-color .2s ease,border-color .2s ease,box-shadow .2s ease,transform .2s ease;display:inline-flex;align-items:center;justify-content:center;gap:var(--space-2);font-size:var(--button-font-size);font-weight:var(--button-font-weight);letter-spacing:var(--letter-spacing-tight);line-height:1.1;box-shadow:var(--btn-shadow);}
.btn:hover,.btn:focus-visible{box-shadow:var(--btn-shadow-hover);transform:translateY(-1px);}
.btn:focus-visible{outline:2px solid var(--ring);outline-offset:2px}
.btn.active{background:color-mix(in srgb,var(--brand) 12%,var(--button-secondary-bg));border-color:var(--brand);color:color-mix(in srgb,var(--brand) 45%,var(--button-secondary-text));box-shadow:inset 0 0 0 1px color-mix(in srgb,var(--brand) 40%,transparent),var(--btn-shadow-hover);}
.btn.brand,.btn.primary{background:var(--button-primary-bg);border-color:var(--button-primary-border);color:var(--button-primary-text);box-shadow:var(--btn-shadow);}
.btn.brand:hover,.btn.primary:hover,.btn.brand:focus-visible,.btn.primary:focus-visible{background:color-mix(in srgb,var(--button-primary-bg) 92%,#ffffff 8%);border-color:color-mix(in srgb,var(--button-primary-border) 70%,#ffffff 30%);color:var(--button-primary-text);}
.btn.secondary{background:var(--button-secondary-bg);color:var(--button-secondary-text);}
.btn.ghost{background:var(--button-ghost-bg);border-color:var(--button-ghost-border);color:var(--button-ghost-text);box-shadow:none}
.btn.ghost:hover,.btn.ghost:focus-visible{background:var(--button-ghost-hover);border-color:var(--button-secondary-border);box-shadow:none}
.btn[data-loading]{pointer-events:none;opacity:.78}
.btn[data-loading]::before{content:"";width:16px;height:16px;margin-right:8px;border-radius:999px;border:2px solid rgba(15,23,42,.2);border-top-color:var(--brand,#6366f1);animation:ui-spin .75s linear infinite}
.btn.good{background:var(--ok);border-color:var(--ok);color:#fff}
.btn.good:hover,.btn.good:focus-visible{background:color-mix(in srgb,var(--ok) 85%,var(--ok-soft) 15%);border-color:color-mix(in srgb,var(--ok) 70%,var(--ok-soft) 30%);}
.btn.warn{background:var(--warn);border-color:var(--warn);color:#111}
.btn.danger{background:var(--bad);border-color:var(--bad);color:#fff}
nav{display:flex;gap:var(--space-2);flex-wrap:wrap;align-items:center}
#universal-search-container{order:1}
.header-new-wrap{order:2}
.header-new-wrap #quick-add-unified{transition:background-color .18s ease,box-shadow .18s ease,transform .18s ease}
.header-new-wrap:hover #quick-add-unified,.header-new-wrap:focus-within #quick-add-unified,#quick-add-unified:focus-visible{box-shadow:var(--btn-shadow-hover);background:color-mix(in srgb,var(--button-primary-bg) 92%,#ffffff 8%);border-color:color-mix(in srgb,var(--button-primary-border) 70%,#ffffff 30%);transform:translateY(-1px)}
.header-new-wrap #quick-add-unified[aria-expanded="true"]{box-shadow:var(--btn-shadow-hover);outline:2px solid var(--ring);outline-offset:2px}
.nav-split{margin-left:auto;order:10}
.pill{padding:6px var(--space-3);border-radius:999px;background:color-mix(in srgb,var(--brand) 12%,#eef2ff);border:1px solid color-mix(in srgb,var(--brand) 35%,transparent);color:var(--ink);font-size:var(--font-size-sm);font-weight:600;letter-spacing:var(--letter-spacing-tight);}
.row{display:flex;gap:var(--space-3)}
.grow{flex:1}
.grid{display:grid;gap:var(--space-3)}
.grid.kpi{grid-template-columns:repeat(auto-fit,minmax(180px,1fr));align-items:stretch}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
.grid.cols-2{grid-template-columns:repeat(2,1fr)}
.grid.insights-grid{grid-template-columns:repeat(auto-fit,minmax(260px,1fr));align-items:stretch}
.grid.opportunities-grid{grid-template-columns:repeat(auto-fit,minmax(260px,1fr));align-items:stretch}
.query-shell{margin-top:8px;padding:12px;border:1px solid #e2e8f0;border-radius:12px;background:#f8fafc;display:flex;flex-direction:column;gap:10px}
.query-rows{display:flex;flex-direction:column;gap:10px}
.query-condition{display:grid;grid-template-columns:minmax(0,200px) minmax(0,140px) minmax(0,1fr) auto;gap:10px;align-items:end}
.query-condition label{display:flex;flex-direction:column;gap:4px;font-size:12px;color:#475569}
.query-condition input,.query-condition select{width:100%}
.query-empty{font-size:12px;color:var(--muted);font-style:italic}
.query-toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.query-remove-btn{background:none;border:none;color:#dc2626;font-weight:700;font-size:18px;line-height:1;padding:2px 6px;cursor:pointer;border-radius:8px}
.query-remove-btn:hover,.query-remove-btn:focus-visible{color:#b91c1c;outline:none;text-decoration:none}
.query-save-row{align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap}
.query-save-row select{min-width:180px;max-width:240px}
.count-badge{display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;padding:0 8px;height:20px;border-radius:999px;background:#eef2ff;color:#312e81;margin-left:6px}
.portfolio-kpis{margin-bottom:16px}
.widget-summary{margin:4px 0 10px;font-size:13px;line-height:1.4}
.settings-shell{display:flex;gap:16px;align-items:flex-start}
.settings-nav{display:flex;flex-direction:column;gap:8px;min-width:200px;position:sticky;top:140px}
.settings-nav .btn{width:100%;justify-content:flex-start}
.settings-panels{flex:1;display:flex;flex-direction:column;gap:16px}
.settings-panel{display:none;flex-direction:column;gap:12px}
.settings-panel.active{display:flex}
.settings-panel-grid{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr))}
.settings-toggle-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.settings-toggle-list .switch{justify-content:space-between}
.panel-head{margin-bottom:8px}
.panel-head h2{margin:0;font-size:18px}
.panel-head p{margin:4px 0 0;font-size:13px}
@media (max-width:960px){
  .settings-shell{flex-direction:column}
  .settings-nav{flex-direction:row;flex-wrap:wrap;position:static}
  .settings-nav .btn{flex:1 1 140px}
  .settings-panel-grid{grid-template-columns:1fr}
}
@media (max-width:900px){
  .modal-main{flex-direction:column}
  .modal-tabs{flex-direction:row;flex-wrap:wrap;position:static}
  .modal-tabs button{flex:1 1 140px}
}
@media (max-width:640px){
  .settings-nav .btn{flex:1 1 100px}
}
@media (max-width:1000px){.grid.kpi{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))} }
.card{background:var(--panel);border:1px solid var(--card-border);border-radius:var(--radius-2xl);padding:var(--card-padding);box-shadow:var(--shadow-card);transition:box-shadow .2s ease,transform .2s ease;}
.card:hover,.card:focus-within{box-shadow:var(--shadow-card-hover);transform:translateY(-1px);}
.muted,.cal-cell.muted .cal-cell-head{color:var(--muted)}
.chip{display:inline-flex;align-items:center;gap:var(--space-1);padding:4px var(--space-2);border-radius:999px;background:var(--chip-bg);border:1px solid var(--chip-border);color:var(--chip-text);font-size:var(--font-size-sm);font-weight:600;letter-spacing:var(--letter-spacing-tight);line-height:var(--line-height-tight);text-transform:uppercase;}
.chip.muted{color:var(--chip-muted);text-transform:none}
.kval{font-size:var(--font-size-xl);font-weight:800;letter-spacing:var(--letter-spacing-tight)}
.hidden{display:none}
.insight-card{display:flex;flex-direction:column;gap:var(--space-3);padding:var(--card-padding)}
.insight-head{display:flex;align-items:flex-start;gap:var(--space-3)}
.insight-head h4{margin:0;font-size:var(--font-size-base);letter-spacing:var(--letter-spacing-tight);line-height:var(--line-height-snug)}
.insight-head p{margin:var(--space-1) 0 0;font-size:var(--font-size-sm);line-height:var(--line-height-snug);color:var(--muted)}
.insight-icon{width:44px;height:44px;border-radius:var(--radius-xl);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:#1e293b}
.insight-icon.calendar{background:linear-gradient(140deg,#eef2ff,#e0f2fe);color:#312e81}
.insight-icon.partners{background:linear-gradient(140deg,#ecfdf5,#d1fae5);color:#0f766e}
.insight-icon.referrals{background:linear-gradient(140deg,#fef3c7,#fde68a);color:#b45309}
.insight-icon.tasks{background:linear-gradient(140deg,#fee2e2,#fecaca);color:#b91c1c}
.insight-icon.timeline{background:linear-gradient(140deg,#cffafe,#bae6fd);color:#0c4a6e}
.insight-icon.pipeline{background:linear-gradient(140deg,#ede9fe,#c7d2fe);color:#3730a3}
.insight-icon.goals{background:linear-gradient(140deg,#ede9fe,#c4b5fd);color:#4338ca}
.insight-icon.relationships{background:linear-gradient(140deg,#e0e7ff,#c7d2fe);color:#1d4ed8}
.insight-icon.nurture{background:linear-gradient(140deg,#fdf2f8,#fbcfe8);color:#be185d}
.insight-icon.closing{background:linear-gradient(140deg,#fef9c3,#fde68a);color:#92400e}
.numbers-card{background:linear-gradient(135deg,#f8fafc,#eef2ff);border:1px solid rgba(99,102,241,.16);box-shadow:0 24px 48px rgba(79,70,229,.12);padding:24px}
.numbers-card-head{align-items:center;gap:16px}
.numbers-card .insight-icon{width:56px;height:56px;border-radius:18px;background:linear-gradient(135deg,#4338ca,#6366f1);color:#fff;font-size:26px;box-shadow:0 16px 38px rgba(79,70,229,.28)}
.numbers-card h4{font-size:20px;letter-spacing:.3px;text-transform:none}
.numbers-card p{font-size:13px;color:#475569}
.actionbar-breakdown,.actionbar-metric{font-size:13px;color:#475569}
.numbers-card-head .count-badge{margin-left:auto}
.numbers-card-body{margin-top:18px;display:flex;flex-direction:column;gap:16px}
.numbers-card-body > .insight-list,.numbers-card-body > ol{flex:1}
.insight-list{display:flex;flex-direction:column;gap:10px;margin:0;padding:0;list-style:none;font-size:13px;color:#1f2937}
.insight-list.ranked{counter-reset:rank}
.insight-list.ranked li{counter-increment:rank;position:relative;padding-left:28px}
.insight-list.ranked li::before{content:counter(rank) ".";position:absolute;left:0;top:2px;font-weight:700;color:#4f46e5}
.insight-list li{border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;background:#f8fafc;display:flex;flex-direction:column;gap:6px}
.insight-row{display:flex;align-items:center;justify-content:space-between;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;background:#f8fafc}
.insight-list.stage-breakdown{gap:14px}
.mini-bar-chart{display:flex;flex-direction:column;gap:10px}
.mini-bar-row{display:grid;grid-template-columns:minmax(0,140px) 1fr minmax(56px,auto);align-items:center;gap:12px;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#f8fafc}
.mini-bar-label{display:flex;align-items:center;gap:8px;font-weight:600;color:#1e293b}
.mini-bar-value{font-weight:600;font-size:12px;color:var(--ink);text-align:right}
.mini-bar-track{position:relative;height:10px;border-radius:999px;background:#e2e8f0;overflow:hidden}
.mini-bar-fill{position:absolute;inset:0;border-radius:999px;background:linear-gradient(90deg,#22d3ee,#4f46e5)}
.mini-bar-dot{width:10px;height:10px;border-radius:999px;background:#4f46e5;box-shadow:0 0 0 2px rgba(79,70,229,.12)}
.momentum-chart .mini-bar-fill{background:linear-gradient(90deg,#6366f1,#22d3ee)}
.portfolio-chart .mini-bar-fill{background:linear-gradient(90deg,#34d399,#10b981)}
.mini-bar-row.empty{display:flex;justify-content:center;color:#475569;font-weight:500;background:#f8fafc;border-style:dashed}
.mini-bar-row.empty .mini-bar-value{display:none}
.mini-bar-row.empty .mini-bar-track{display:none}
.insight-list .list-main{display:flex;align-items:center;gap:10px}
.insight-avatar{width:34px;height:34px;border-radius:12px;background:#eef2ff;color:#312e81;font-weight:700;display:flex;align-items:center;justify-content:center}
.initials-avatar{width:28px;height:28px;border-radius:999px;background:#eef2ff;color:#312e81;font-weight:700;display:inline-flex;align-items:center;justify-content:center;font-size:12px;letter-spacing:.3px;flex-shrink:0}
.initials-avatar::before{content:attr(data-initials)}
.initials-avatar.is-empty{background:#e2e8f0;color:#475569}
.insight-title{font-weight:700;font-size:14px;color:var(--ink)}
.insight-sub{font-size:12px;color:#475569}
.insight-meta{font-size:12px;color:#1e293b;font-weight:600}
.insight-meta.bad{color:#b91c1c}
.insight-meta.warn{color:#b45309}
.insight-meta.good{color:#047857}
.insight-tag{display:inline-flex;align-items:center;gap:6px;font-size:11px;padding:4px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:600;text-transform:uppercase;letter-spacing:.3px}
.insight-tag.light{background:#f1f5f9;color:#475569}
.insight-pill{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:600;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#3730a3}
.insight-pill.core{background:#e0f2fe;color:#075985}
.insight-pill.preferred{background:#dcfce7;color:#047857}
.insight-pill.strategic{background:#ede9fe;color:#5b21b6}
.insight-pill.developing{background:#fef9c3;color:#92400e}
.insight-list .empty{border:1px dashed #cbd5f5;background:#f8fafc;color:#475569;text-align:center;padding:16px}
.insight-list.actionable li{border-left:4px solid #f97316;padding-left:12px}
.insight-list.actionable li.overdue{border-left-color:#dc2626}
.insight-list.actionable li .insight-meta{display:flex;align-items:center;gap:6px}
#referral-leaderboard{display:flex;flex-direction:column;gap:12px}
#referral-leaderboard .leaderboard-head{display:flex;align-items:center;gap:8px;margin-bottom:4px}
#referral-leaderboard .leaderboard-controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:4px;font-size:12px;color:var(--muted)}
#referral-leaderboard .leaderboard-controls label{display:flex;align-items:center;gap:6px;font-weight:500}
#referral-leaderboard .leaderboard-controls select{min-width:120px;font-size:12px;padding:4px 10px;border-radius:8px;border:1px solid rgba(148,163,184,.45);background:#fff;color:var(--ink)}
#referral-leaderboard .leaderboard-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
#referral-leaderboard .leaderboard-item{display:flex;align-items:flex-start;gap:12px;padding:12px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;transition:background .2s ease,border-color .2s ease,box-shadow .2s ease}
#referral-leaderboard .leaderboard-item:hover{background:#f8fafc;border-color:rgba(99,102,241,.35);box-shadow:0 10px 18px rgba(15,23,42,.08)}
#referral-leaderboard .leaderboard-rank{font-weight:600;width:28px;text-align:center;font-variant-numeric:tabular-nums}
#referral-leaderboard .leaderboard-name{flex:1 1 auto;display:flex;flex-direction:column;gap:6px}
#referral-leaderboard .leaderboard-name-main{display:flex;align-items:center;gap:8px}
#referral-leaderboard .leaderboard-tier{font-size:10px;text-transform:uppercase;letter-spacing:.4px;padding:2px 8px}
#referral-leaderboard .leaderboard-metrics{display:flex;flex-wrap:wrap;gap:12px;align-items:flex-start}
#referral-leaderboard .leaderboard-metric{display:flex;flex-direction:column;min-width:92px}
#referral-leaderboard .leaderboard-metric .label{font-size:10px;text-transform:uppercase;letter-spacing:.4px;color:var(--muted)}
#referral-leaderboard .leaderboard-metric .value{font-weight:600;font-size:13px;color:var(--ink)}
.pipeline-calendar{display:flex;flex-direction:column;gap:var(--space-3)}
.pipeline-timeline{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:var(--space-3)}
.pipeline-timeline li{display:grid;grid-template-columns:minmax(80px,110px) 1fr minmax(64px,auto);gap:var(--space-3);align-items:center;padding:var(--space-2) var(--space-3);border:1px solid #e5e7eb;border-radius:var(--radius-lg);background:#f8fafc}
.calendar-surface{display:grid;gap:var(--space-3);}
[data-qa="cal-legend"]{display:flex;flex-wrap:wrap;gap:var(--space-2);padding:var(--space-2) var(--space-3);border-radius:var(--radius-lg);background:var(--surface-subtle);border:1px solid var(--calendar-grid-line);box-shadow:0 6px 14px rgba(15,23,42,.06);}
[data-qa="cal-legend"] [data-type]{display:inline-flex;align-items:center;gap:var(--space-2);font-size:var(--font-size-sm);font-weight:600;letter-spacing:var(--letter-spacing-tight);color:var(--ink);--event-accent:var(--accent-other);}
[data-qa="cal-legend"] [data-type="contact"],.event-chip[data-type="contact"]{--event-accent:var(--accent-contact);}
[data-qa="cal-legend"] [data-type="task"],.event-chip[data-type="task"]{--event-accent:var(--accent-task);}
[data-qa="cal-legend"] [data-type="milestone"],.event-chip[data-type="milestone"]{--event-accent:var(--accent-milestone);}
[data-qa="cal-legend"] [data-type="other"],.event-chip[data-type="other"]{--event-accent:var(--accent-other);}
[data-qa="cal-legend"] [data-type]::before{content:"";display:inline-block;width:var(--space-3);height:var(--space-3);border-radius:999px;background:var(--event-accent);box-shadow:0 0 0 2px rgba(255,255,255,.9),0 0 0 3px rgba(15,23,42,.08);}
.cal-legend-icon{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:999px;background:color-mix(in srgb,var(--event-accent) 16%,#fff);color:var(--event-accent);font-size:12px;font-weight:600;}
.cal-legend-label{font-size:var(--font-size-sm);font-weight:600;letter-spacing:var(--letter-spacing-tight);color:var(--ink);}
.calendar-month-grid{display:grid;gap:var(--space-3);grid-template-columns:repeat(7,minmax(0,1fr));}
.calendar-cell{position:relative;display:grid;grid-template-rows:auto 1fr;gap:var(--space-2);padding:var(--space-2);border-radius:var(--radius-lg);background:var(--surface-elevated);border:1px solid var(--calendar-grid-line);min-height:120px;box-shadow:0 1px 2px rgba(15,23,42,.04);}
.calendar-cell.is-weekend{background:var(--calendar-weekend);}
.calendar-cell.is-outside{opacity:.78;}
.calendar-cell.is-today{box-shadow:0 0 0 3px var(--calendar-today-ring);border-color:rgba(10,102,194,.35);}
.calendar-cell-header{display:flex;justify-content:space-between;align-items:center;font-size:13px;font-weight:600;color:var(--ink);}
.calendar-cell-header .weekday{color:var(--muted);font-size:12px;font-weight:500;}
.calendar-cell-events{display:flex;flex-direction:column;gap:var(--space-2);}
.event-chip{display:flex;flex-direction:column;gap:var(--space-1);padding:var(--space-2) var(--space-3);border-radius:var(--radius-lg);background:var(--event-chip-bg);border:1px solid var(--event-chip-border);box-shadow:var(--event-chip-shadow);position:relative;isolation:isolate;min-height:44px;cursor:default;transition:transform .2s ease,box-shadow .2s ease;}
.event-chip::before{content:"";position:absolute;inset-inline-start:0;top:0;bottom:0;width:4px;border-radius:var(--radius-lg) 0 0 var(--radius-lg);background:var(--event-accent);}
.event-chip:focus-visible,.event-chip:hover{transform:translateY(-1px);box-shadow:var(--event-chip-shadow-hover);outline:2px solid var(--ring);outline-offset:2px;}
.event-chip.is-draggable{cursor:grab;}
.event-chip.is-dragging{cursor:grabbing;box-shadow:var(--event-chip-shadow-hover);opacity:.92;}
.event-chip .event-chip-head{display:flex;justify-content:space-between;align-items:center;gap:var(--space-2);font-size:var(--font-size-sm);font-weight:600;color:var(--ink);letter-spacing:var(--letter-spacing-tight);}
.event-chip .event-chip-label{display:inline-flex;align-items:center;gap:var(--space-2);min-width:0;}
.event-chip .cal-event-icon{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:999px;background:color-mix(in srgb,var(--event-accent) 16%,#fff);color:var(--event-accent);font-size:12px;font-weight:600;flex-shrink:0;}
.event-chip .event-chip-time{font-size:var(--font-size-xs);color:var(--muted);font-weight:500;letter-spacing:var(--letter-spacing-tight);}
.event-chip .event-chip-meta{font-size:var(--font-size-xs);color:var(--muted);display:flex;flex-wrap:wrap;gap:var(--space-1);letter-spacing:var(--letter-spacing-tight);}
.event-chip button{align-self:flex-start;}
.event-chip[data-category="meeting"]{--event-chip-bg:color-mix(in srgb,var(--accent-contact) 14%,#fff);--event-chip-border:color-mix(in srgb,var(--accent-contact) 32%,transparent);}
.event-chip[data-category="call"]{--event-chip-bg:color-mix(in srgb,var(--accent-task) 16%,#fff);--event-chip-border:color-mix(in srgb,var(--accent-task) 34%,transparent);}
.followup-scheduler{background:var(--surface-elevated,#fff);border:1px solid rgba(148,163,184,.3);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;box-shadow:0 10px 18px rgba(15,23,42,.06)}
.followup-scheduler .btn{width:100%}
.followup-suggestion{display:flex;flex-direction:column;gap:6px;padding:8px 10px;border-radius:10px;background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.25)}
.followup-suggestion .muted{color:var(--muted)}
.followup-suggestion .btn{align-self:flex-start;width:auto;min-width:0}
.followup-scheduler [data-role="followup-status"]{min-height:18px;font-size:12px}
.milestone-badge.is-disabled{opacity:.45;border-style:dashed;cursor:not-allowed;pointer-events:none}
select option.is-disabled{color:var(--muted)}
.event-chip[data-category="deadline"]{--event-chip-bg:color-mix(in srgb,var(--accent-milestone) 18%,#fff);--event-chip-border:color-mix(in srgb,var(--accent-milestone) 36%,transparent);}
.event-chip[data-category="other"]{--event-chip-bg:color-mix(in srgb,var(--accent-other) 12%,#fff);--event-chip-border:color-mix(in srgb,var(--accent-other) 28%,transparent);}
.calendar-more{border:none;background:rgba(15,23,42,.06);color:#1f2937;font-weight:600;border-radius:999px;padding:var(--space-1) var(--space-3);font-size:var(--font-size-xs);letter-spacing:var(--letter-spacing-tight);cursor:pointer;align-self:flex-start;transition:background .15s ease,box-shadow .15s ease;}
.calendar-more:hover,.calendar-more:focus-visible{background:rgba(15,23,42,.12);box-shadow:0 6px 16px rgba(15,23,42,.12);outline:2px solid var(--ring);outline-offset:2px;}
.calendar-popover{position:absolute;z-index:60;min-width:220px;max-width:320px;display:flex;flex-direction:column;gap:var(--space-2);padding:var(--space-3);border-radius:14px;background:var(--surface-elevated);border:1px solid var(--calendar-popover-border);box-shadow:var(--calendar-popover-shadow);transform-origin:top;top:var(--popover-top,50%);left:var(--popover-left,0);}
.calendar-popover[data-open="1"]{animation:calendar-popover-in .16s ease-out;}
.calendar-drag-ghost{position:fixed;z-index:2000;pointer-events:none;padding:var(--space-2) var(--space-3);border-radius:var(--radius-lg);background:var(--surface-elevated,#fff);border:1px solid var(--calendar-grid-line);box-shadow:var(--event-chip-shadow-hover);font-size:var(--font-size-sm);font-weight:600;color:var(--ink);transform:translate(-9999px,-9999px);}
.calendar-cell.calendar-drop-target,.calendar-week-slot.calendar-drop-target,.calendar-day-slot.calendar-drop-target{outline:2px dashed var(--ring);outline-offset:2px;}
@keyframes calendar-popover-in{from{opacity:0;transform:translateY(-6px);}to{opacity:1;transform:translateY(0);}}
.calendar-week-grid{display:grid;gap:var(--space-3);}
.calendar-week-header{display:grid;grid-template-columns:72px repeat(7,minmax(0,1fr));gap:var(--space-2);font-size:13px;font-weight:600;color:var(--muted);}
.calendar-week-body{position:relative;border:1px solid var(--calendar-grid-line);border-radius:14px;overflow:hidden;background:var(--surface-elevated);}
.calendar-week-hours{position:relative;display:grid;grid-template-rows:repeat(24,var(--calendar-hour-height));}
.calendar-week-hour{display:grid;grid-template-columns:72px repeat(7,minmax(0,1fr));align-items:stretch;border-top:1px solid var(--calendar-grid-line);}
.calendar-week-hour:first-child{border-top:none;}
.calendar-time-label{display:flex;align-items:flex-start;justify-content:flex-end;padding:6px 10px;font-size:12px;color:var(--muted);}
.calendar-week-slot{position:relative;padding:6px;display:flex;flex-direction:column;gap:var(--space-2);border-inline-start:1px solid var(--calendar-grid-line);background:rgba(255,255,255,.35);}
.calendar-week-slot:first-child{border-inline-start:none;}
.calendar-week-hour .calendar-week-slot:first-of-type,.calendar-week-allday .calendar-week-slot:first-of-type{border-inline-start:none;}
.calendar-week-slot.is-weekend{background:var(--calendar-weekend);}
.calendar-week-slot.is-today{box-shadow:inset 0 0 0 2px rgba(10,102,194,.2);background:rgba(10,102,194,.08);}
.calendar-week-allday{display:grid;grid-template-columns:72px repeat(7,minmax(0,1fr));gap:var(--space-2);padding:var(--space-2) var(--space-2) 0;}
.calendar-week-allday .calendar-week-slot{min-height:48px;border-radius:12px;border:1px solid var(--calendar-grid-line);background:rgba(148,163,184,.08);}
.calendar-week-body .calendar-week-allday{border-bottom:1px solid var(--calendar-grid-line);margin-bottom:var(--space-2);}
.calendar-day-grid{display:grid;gap:var(--space-3);}
.calendar-day-all{display:grid;grid-template-columns:96px 1fr;gap:var(--space-2);padding:var(--space-2);border:1px solid var(--calendar-grid-line);border-radius:14px;background:var(--surface-elevated);}
.calendar-day-body{position:relative;border:1px solid var(--calendar-grid-line);border-radius:14px;overflow:hidden;background:var(--surface-elevated);}
.calendar-day-hours{position:relative;display:grid;grid-template-rows:repeat(24,var(--calendar-hour-height));}
.calendar-day-hour{display:grid;grid-template-columns:96px 1fr;border-top:1px solid var(--calendar-grid-line);}
.calendar-day-hour:first-child{border-top:none;}
.calendar-day-slot{padding:6px 10px;display:flex;flex-direction:column;gap:var(--space-2);background:rgba(255,255,255,.35);}
.calendar-day-slot.is-weekend{background:var(--calendar-weekend);}
.calendar-day-slot.is-today{box-shadow:inset 0 0 0 2px rgba(10,102,194,.2);background:rgba(10,102,194,.08);}
.calendar-now-line{position:absolute;left:72px;right:0;height:0;border-top:2px solid var(--brand);top:calc(var(--now-line-offset,0) * 1%);box-shadow:0 0 0 1px rgba(10,102,194,.1);pointer-events:none;z-index:40;}
.calendar-day-body .calendar-now-line{left:96px;}
.calendar-now-line::before{content:"";position:absolute;left:-8px;top:-4px;width:10px;height:10px;border-radius:999px;background:var(--brand);box-shadow:0 0 0 2px #fff;}
.calendar-empty{font-size:12px;color:var(--muted);}
.pipeline-date{font-weight:700;font-size:13px;color:var(--ink)}
.pipeline-detail{display:flex;flex-direction:column;gap:4px}
.pipeline-label{font-weight:600;font-size:13px;color:var(--ink)}
.pipeline-meta{font-size:12px;color:#475569}
.pipeline-type{justify-self:end;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.35px;padding:4px 8px;border-radius:999px;background:#eef2ff;color:#312e81}
.pipeline-type.task{background:#fee2e2;color:#b91c1c}
.pipeline-type.deal{background:#dcfce7;color:#047857}
.pipeline-type.followup{background:#fef3c7;color:#92400e}
.pipeline-type.expiring{background:#fefce8;color:#92400e}
.pipeline-calendar .empty{border:1px dashed #cbd5f5;background:#f8fafc;padding:16px;border-radius:12px;text-align:center;font-size:13px;color:#475569}
.goal-progress{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.goal-line{display:flex;flex-direction:column;gap:6px}
.goal-meta{display:flex;justify-content:space-between;align-items:center;font-size:13px}
.goal-meta strong{font-size:14px}
.goal-bar{position:relative;height:10px;border-radius:999px;background:#e2e8f0;overflow:hidden}
.goal-bar span{display:block;height:100%;background:linear-gradient(90deg,#22d3ee,#4f46e5);border-radius:999px;width:0;opacity:.2;transition:width .3s ease,opacity .3s ease}
.goal-footnote{font-size:12px}
.goal-empty{border:1px dashed #cbd5f5;border-radius:12px;padding:12px;text-align:center;font-size:13px;background:#f8fafc}
.status-dot{width:8px;height:8px;border-radius:999px;background:#94a3b8}
.status-dot.overdue{background:#dc2626}
.status-dot.soon{background:#f97316}
.status-dot.ready{background:#0ea5e9}
.span-2{grid-column:span 2}
.span-full{grid-column:1/-1}
@media (max-width:720px){
  .span-2{grid-column:auto}
  .span-full{grid-column:auto}
  .query-condition{grid-template-columns:1fr 1fr;grid-auto-rows:auto}
}
table{width:100%;border-collapse:separate;border-spacing:0;position:relative;--table-scrollbar-width:0px}
th,td{text-align:left;padding:10px;border-bottom:1px solid #e5e7eb}
.table-wrap{max-width:100%;overflow-x:auto;overflow-y:hidden;position:relative;scrollbar-gutter:stable both-edges}
.table-managed{width:100%;border-collapse:separate;border-spacing:0;position:relative}
.table-managed colgroup[data-role="layout"] col{min-width:0}
.table-managed th,.table-managed td{overflow:hidden;text-overflow:ellipsis;vertical-align:middle;min-width:0;white-space:nowrap}
.table-managed td>*{min-width:0;max-width:100%}
.table-managed td>a{display:inline-flex;align-items:center;gap:4px;min-width:0;max-width:100%;overflow:hidden;text-overflow:ellipsis}
.table-managed td .contact-name,.table-managed td .partner-name{display:inline-flex;align-items:center;gap:6px;max-width:100%;overflow:hidden;text-overflow:ellipsis;min-width:0}
.table-managed th[data-wrap="1"],.table-managed td[data-wrap="1"]{white-space:normal}
.table-managed th[data-compact="1"],.table-managed td[data-compact="1"]{white-space:nowrap}
.table-managed th[data-role="select"],.table-managed td[data-role="select"]{width:44px;text-align:center}
.table-managed th[data-role="select"]{padding-left:8px;padding-right:8px}
.table-managed td[data-role="select"]{padding-left:8px;padding-right:8px}
.table-managed th[data-role="gutter"],.table-managed td[data-role="gutter"]{padding:0;border-bottom:none;pointer-events:none;width:var(--table-scrollbar-width,0px);min-width:0}
.table-managed td[data-role="gutter"]::after{content:"";display:block;width:var(--table-scrollbar-width,0px)}
.table-managed[data-table-layout-ready="1"]{table-layout:fixed}
.table-managed[data-table-layout-ready="1"] thead tr{position:sticky;top:0;background:#fbfdff;z-index:2}
.table-managed[data-table-layout-ready="1"] thead tr::after{content:"";position:absolute;top:0;right:0;bottom:0;width:var(--table-scrollbar-width,0px);background:inherit;pointer-events:none}
thead th{position:sticky;top:0;background:#fbfdff;z-index:2}
tr:hover td{background:#fafafa}
.portfolio-table{table-layout:fixed;width:100%;border-collapse:separate;border-spacing:0}
.portfolio-table th,.portfolio-table td{padding:10px 12px;box-sizing:border-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:middle}
.portfolio-table thead th{background:inherit;border-bottom:1px solid #e2e8f0}
.portfolio-table tbody td{border-bottom:1px solid #f1f5f9}
.portfolio-table tbody tr:last-child td{border-bottom:none}
.portfolio-table col.portfolio-col-name{width:clamp(220px,28%,320px)}
.portfolio-table col.portfolio-col-type{width:clamp(140px,18%,200px)}
.portfolio-table col.portfolio-col-amount{width:clamp(120px,14%,160px)}
.portfolio-table col.portfolio-col-date{width:clamp(150px,20%,220px)}
.portfolio-table col.portfolio-col-partner{width:clamp(180px,20%,260px)}
.portfolio-table th:nth-child(3),.portfolio-table td:nth-child(3){text-align:right;font-variant-numeric:tabular-nums}
.portfolio-table-wrap{max-width:100%;overflow-x:auto}
.portfolio-card-header{display:flex;align-items:center;gap:var(--space-3);flex-wrap:wrap;margin:0 0 var(--space-3)}
.portfolio-card-title{margin:0;flex:1 1 auto;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.portfolio-card-header .table-search{margin:0;flex:0 0 auto;max-width:100%}
.portfolio-card-header .table-search input{width:220px;max-width:100%}
@media (max-width:720px){
  .portfolio-card-header .table-search{flex:1 1 100%}
  .portfolio-card-header .table-search input{width:100%}
}
.table-scroll-host{scrollbar-gutter:stable both-edges}
#view-workbench{max-width:100vw;width:100%;padding-block:var(--space-5);overflow-x:hidden;box-sizing:border-box;padding-inline:var(--space-3)}
.workbench-shell{display:flex;flex-direction:column;gap:var(--space-4);min-width:0;max-width:100%}
.workbench-shell .legend-inline-row{display:flex;justify-content:flex-end;flex-wrap:wrap;gap:var(--space-2);margin-bottom:var(--space-2)}
#workbench-root{max-width:100%;width:100%;display:flex;flex-direction:column;gap:var(--space-4);overflow:visible;min-width:0;box-sizing:border-box}
#workbench-root .card{min-width:0;max-width:100%;box-sizing:border-box}
.workbench-window{display:flex;flex-direction:column;gap:var(--space-4);max-width:100%}
.workbench-window__header{align-items:center;gap:var(--space-3);flex-wrap:wrap;margin-bottom:var(--space-3)}
.workbench-window__title{margin:0;font-size:var(--font-size-lg);line-height:var(--line-height-snug);font-weight:700;color:var(--ink)}
.workbench-window__count{font-size:var(--font-size-sm)}
.workbench-window-body{display:flex;flex-direction:column;gap:var(--space-4);margin-top:var(--space-3);max-width:100%;overflow-x:hidden;min-width:0}
.workbench-window-body>*{min-width:0}
.workbench-controls{display:flex;flex-direction:column;gap:var(--space-3);min-width:0}
.workbench-filter-row{display:flex;flex-wrap:wrap;align-items:center;gap:var(--space-2);min-width:0}
.workbench-filters{display:flex;flex-direction:column;gap:var(--space-2);min-width:0}
.workbench-saved-queries-wrap{display:flex;flex-direction:column;gap:var(--space-2);margin-top:var(--space-3)}
.workbench-saved-queries{display:flex;flex-direction:column;gap:var(--space-2);min-width:0}
.workbench-search-row{display:flex;flex-wrap:wrap;align-items:center;gap:var(--space-2);margin-top:var(--space-3)}
.workbench-status{margin-left:auto;display:flex;align-items:center;gap:var(--space-2);min-height:24px;font-size:var(--font-size-sm)}
.workbench-preset-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:var(--space-2)}
#workbench-root .table-wrap{margin-top:var(--space-2);max-width:100%;overflow-x:auto;overflow-y:hidden;position:relative;scrollbar-gutter:stable both-edges;padding-bottom:var(--space-1);box-sizing:border-box;overscroll-behavior:x contain}
#workbench-root .table-wrap table{width:100%;min-width:0}
tbody[data-skeleton="1"] tr:hover td{background:transparent}
[data-skeleton-row] td{padding:12px 10px;border-bottom:1px solid rgba(226,232,240,.7)}
.skeleton-bar,.skeleton-dot,.loading-line{background:linear-gradient(90deg,rgba(226,232,240,.82) 0%,rgba(203,213,225,.64) 45%,rgba(226,232,240,.82) 100%);background-size:200% 100%;animation:loading-shimmer 1.2s ease-in-out infinite}
.skeleton-dot{width:18px;height:18px;border-radius:999px;margin-inline:auto}
.skeleton-bar{display:block;height:12px;border-radius:999px;width:var(--skeleton-bar-width,60%);max-width:100%}
.loading-host{position:relative}
.loading-block{display:none;flex-direction:column;gap:10px;padding:8px 0}
.loading-host.is-loading{pointer-events:none}
.loading-host.is-loading>.loading-block{display:flex}
.loading-host.is-loading>:not(.loading-block){opacity:0}
.loading-line{display:block;height:12px;border-radius:999px;width:var(--loading-line-width,60%)}
@keyframes loading-shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
textarea{min-height:100px}
.actionbar{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;display:flex;z-index:1200;pointer-events:none}
.actionbar[data-idle-visible="0"]{display:none}
.actionbar.has-selection,.summary-metric span{display:block}
.actionbar-shell{pointer-events:auto;display:flex;flex-direction:column;gap:12px;background:rgba(255,255,255,.95);border-radius:18px;border:1px solid rgba(15,23,42,.12);box-shadow:0 24px 48px rgba(15,23,42,.18);padding:16px 20px;min-width:320px;max-width:90vw;position:relative;padding-right:92px}
.fab{position:fixed;left:50%;bottom:var(--fab-safe-bottom);transform:translateX(-50%);min-width:56px;min-height:56px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;background:var(--primary);color:var(--primary-text);font-size:30px;font-weight:600;line-height:1;border:none;padding:0;box-shadow:0 12px 32px rgba(10,102,194,0.3);z-index:10000}
@media (prefers-reduced-motion:reduce){.fab{transition:none;animation:none}}
.actionbar-meta{display:flex;align-items:center;flex-wrap:wrap;gap:14px}
.actionbar-count{font-weight:700;font-size:15px;color:var(--ink)}
.actionbar-stages,.legend-list{display:flex;flex-wrap:wrap;gap:8px}
.actionbar-stage-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid #c7d2fe;background:#eef2ff;font-size:11px;font-weight:600;letter-spacing:.35px;text-transform:uppercase;color:#3730a3}
.actionbar-stage-chip[data-stage="processing"],.actionbar-stage-chip[data-stage="underwriting"],.doc-status-row .status-pill[data-tone="pending"],.linked-stage[data-stage="processing"],.linked-stage[data-stage="underwriting"],.doc-chip[data-status="waived"],.legend-chip.loan.loan-construction{background:#fef3c7;border-color:#fde68a;color:#92400e}
.actionbar-stage-chip[data-stage="approved"],.actionbar-stage-chip[data-stage="cleared-to-close"],.actionbar-stage-chip[data-stage="ctc"],.linked-stage[data-stage="approved"],.linked-stage[data-stage="cleared-to-close"],.linked-stage[data-stage="ctc"]{background:#dcfce7;border-color:#bbf7d0;color:#047857}
.actionbar-stage-chip[data-stage="funded"],.linked-stage[data-stage="funded"]{background:#f1f5f9;border-color:#cbd5f5;color:var(--ink)}
.actionbar-stage-chip[data-stage="post-close"],.actionbar-stage-chip[data-stage="nurture"],.linked-stage[data-stage="post-close"],.linked-stage[data-stage="nurture"]{background:#e0f2fe;border-color:#bae6fd;color:#0369a1}
.actionbar-stage-chip[data-stage="lost"],.actionbar-stage-chip[data-stage="denied"],.doc-status-row .status-pill[data-tone="follow"],.kanban-priority[data-level="hot"],.linked-stage[data-stage="lost"],.linked-stage[data-stage="denied"]{background:#fee2e2;border-color:#fecaca;color:#b91c1c}
.actionbar-names{font-size:12px;color:#1e293b;background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:8px 12px}
.actionbar-actions,.doc-automation-actions{display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end}
.actionbar-actions .btn{border-radius:12px;padding:8px 14px}
.actionbar-busy{position:absolute;top:14px;right:20px;display:flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:rgba(15,23,42,.94);color:#f8fafc;font-size:12px;font-weight:600;letter-spacing:.02em;box-shadow:0 18px 36px rgba(15,23,42,.18);pointer-events:none;opacity:0;transform:translateY(-6px);transition:opacity .18s ease,transform .18s ease}
.actionbar-busy[hidden]{display:none!important}
.actionbar.is-busy .actionbar-busy{opacity:1;transform:translateY(0)}
.actionbar.is-busy .actionbar-actions .btn{pointer-events:none;opacity:.55}
.actionbar.is-busy .actionbar-shell{opacity:.96}
:is(dialog,.record-modal)[data-loading]{position:relative;pointer-events:none}
:is(dialog,.record-modal)[data-loading]::after{content:"";position:absolute;inset:0;background:rgba(15,23,42,.28);border-radius:inherit;z-index:4}
:is(dialog,.record-modal)[data-loading]::before{content:"";position:absolute;top:50%;left:50%;margin:-18px 0 0 -18px;width:36px;height:36px;border-radius:999px;border:3px solid rgba(248,250,252,.45);border-top-color:#f8fafc;animation:ui-spin .8s linear infinite;z-index:5;box-shadow:0 10px 24px rgba(15,23,42,.24)}
:is(dialog,.record-modal)[data-loading]>*{filter:saturate(.9)}
:is(.toast-host,.toast){position:fixed;bottom:24px;right:24px;background:rgba(15,23,42,.94);color:#f8fafc;padding:12px 16px;border-radius:14px;display:flex;align-items:center;gap:12px;max-width:min(360px,calc(100vw - 40px));font-size:13px;line-height:1.45;letter-spacing:.01em;box-shadow:0 16px 42px rgba(15,23,42,.28);opacity:0;transform:translateY(6px);transition:opacity .18s ease,transform .18s ease;pointer-events:none;z-index:2147483647}
.toast{left:50%;right:auto;bottom:20px;transform:translate(-50%,6px)}
.toast.show{opacity:1;transform:translate(-50%,0)}
.toast-host{left:auto}
.toast-host[data-visible="true"]{opacity:1;transform:translateY(0)}
.toast-host[data-has-action="true"],.toast.show{pointer-events:auto}
:is(.toast-host,.toast) .toast-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;background:rgba(248,250,252,.18);color:inherit;flex-shrink:0}
:is(.toast-host,.toast) .toast-icon svg{width:16px;height:16px}
:is(.toast-host,.toast) .toast-icon .ui-spinner{width:16px;height:16px;border-width:2px}
:is(.toast-host,.toast) .toast-message{flex:1;min-width:0}
:is(.toast-host,.toast) button{border:1px solid rgba(248,250,252,.55);background:transparent;color:inherit;font-weight:600;padding:4px 12px;border-radius:999px;cursor:pointer;transition:background .18s ease,color .18s ease}
:is(.toast-host,.toast) button:hover{background:rgba(248,250,252,.18)}
:is(.toast-host,.toast)[data-variant="success"]{background:#166534;color:#ecfdf5}
:is(.toast-host,.toast)[data-variant="success"] .toast-icon{background:rgba(236,253,245,.28);color:#bbf7d0}
:is(.toast-host,.toast)[data-variant="info"]{background:#1d4ed8;color:#e0ecff}
:is(.toast-host,.toast)[data-variant="info"] .toast-icon{background:rgba(37,99,235,.25);color:#bfdbfe}
:is(.toast-host,.toast)[data-variant="warn"]{background:#b45309;color:#fff7ed}
:is(.toast-host,.toast)[data-variant="warn"] .toast-icon{background:rgba(251,191,36,.25);color:#fde68a}
:is(.toast-host,.toast)[data-variant="error"]{background:#b91c1c;color:#fee2e2}
:is(.toast-host,.toast)[data-variant="error"] .toast-icon{background:rgba(254,226,226,.25);color:#fecaca}
:is(.toast-host,.toast)[data-variant="loading"] .toast-icon{background:rgba(248,250,252,.18);color:#f8fafc}
:is(.toast-host,.toast)[data-variant="loading"] .ui-spinner{border-color:rgba(248,250,252,.4);border-top-color:#f8fafc}
@keyframes ui-spin{to{transform:rotate(360deg)}}
.ui-spinner{width:18px;height:18px;border-radius:999px;border:3px solid rgba(15,23,42,.18);border-top-color:var(--brand,#6366f1);display:inline-block;animation:ui-spin .75s linear infinite}
.actionbar-busy .ui-spinner{border-color:rgba(248,250,252,.35);border-top-color:#f8fafc}
dialog{border:none;border-radius:16px;box-shadow:0 12px 40px #0002;padding:0}
dialog .dlg{padding:18px;min-width:620px;background:#fff;border-radius:16px;display:flex;flex-direction:column;max-height:88vh;box-sizing:border-box}
dialog[open]{pointer-events:auto}
dialog[open] .dlg{outline:none}
.help-modal{min-width:min(760px,96vw);max-width:min(960px,98vw)}
.help-body{display:flex;flex-direction:column;gap:14px}
.help-section{border:1px solid #e2e8f0;border-radius:14px;padding:14px 16px;background:linear-gradient(135deg,#f8fafc,#eef2ff)}
.help-section h4{margin:0;font-size:15px;letter-spacing:.01em;color:#0f172a}
.help-section .muted{margin:6px 0 0}
.help-list{margin:10px 0 0;padding-left:18px;line-height:1.55;color:var(--muted);font-size:13px}
.help-list li{margin-bottom:6px}
dialog::backdrop{background:#0004}
.switch{display:flex;align-items:center;gap:8px}
.badge-pill{display:inline-block;border-radius:999px;padding:3px 8px;background:#f1f5f9;border:1px solid #e5e7eb}
.tag{font-size:12px;padding:2px 6px;border-radius:8px;border:1px solid #e5e7eb}
.doc-status{display:flex;flex-direction:column;gap:12px}
.doc-status-overview{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:14px;background:linear-gradient(135deg,#eef2ff,#e0f2fe);border:1px solid #dbeafe}
.doc-status-overview strong{font-size:18px;color:var(--ink)}
.doc-status-overview span{font-size:12px;color:#475569}
.doc-status-row{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid #e2e8f0;box-shadow:0 10px 24px rgba(15,23,42,.08)}
.doc-status-row .status-pill{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.3px;padding:4px 10px;border-radius:999px;border:1px solid transparent}
.doc-status-row .status-pill[data-tone="ok"]{background:#ecfdf5;border-color:#bbf7d0;color:#047857}
.doc-status-row .status-pill[data-tone="waived"]{background:#f1f5f9;border-color:#e2e8f0;color:#475569}
.doc-status-row .bar{flex:1;height:8px;border-radius:999px;background:#e2e8f0;overflow:hidden;position:relative}
.doc-status-row .bar span{display:block;height:100%;background:var(--bar-color,#6366f1)}
.doc-status-row .count{font-size:15px;font-weight:700;color:var(--ink)}
.doc-status-row .meta{font-size:11px;color:#64748b}

.status-stack{display:flex;flex-direction:column;gap:16px}
.status-panel{background:#fff;border:1px solid #e2e8f0;border-radius:14px;overflow:hidden}
.status-panel summary{list-style:none;cursor:pointer;padding:14px 16px;border-bottom:1px solid #e2e8f0;outline:none;display:flex;align-items:center}
.status-panel summary::-webkit-details-marker{display:none}
.status-panel[open]>summary{border-bottom-color:#e2e8f0}
.status-summary{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.status-sub{font-size:12px;margin-top:4px}
.status-count{font-size:13px;font-weight:600;color:#475569;white-space:nowrap}
.status-controls{display:flex;flex-direction:column;padding:12px 16px;gap:12px;background:linear-gradient(145deg,#f8fafc,#eef2ff)}
.status-search input{width:100%;max-width:100%}
.status-actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.status-actions .btn,.status-actions select{flex:0 0 auto}
.table-search{margin:8px 0}
.table-search input{width:100%;max-width:100%}
.status-table-wrap{overflow:auto;max-height:70vh;border-top:1px solid #e2e8f0;background:#fff;scrollbar-gutter:stable both-edges}
.status-table{min-width:960px;table-layout:auto}
.status-table th, .status-table td{padding:12px 10px}
.status-table td{white-space:nowrap;vertical-align:middle}
.status-table td:nth-child(2){white-space:normal;max-width:200px;overflow:hidden;text-overflow:ellipsis}
.status-table th[data-column="select"], .status-table td[data-role="select"]{width:44px;text-align:center;padding:8px}
.status-name-link, .contact-name{display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:normal;line-height:1.4;cursor:pointer;text-decoration:none;color:var(--brand);font-weight:500}
.status-name-link:hover, .contact-name:hover{text-decoration:underline}
.sort-btn{display:inline-flex;align-items:center;gap:6px;background:none;border:none;padding:0;font:inherit;color:inherit;cursor:pointer}
.sort-btn .sort-icon{font-size:12px;color:#94a3b8}
.sort-btn:focus-visible{outline:2px solid var(--ring);outline-offset:2px;border-radius:8px}
table.list-table th .sort-btn[data-type="number"]{justify-content:flex-end;width:100%}
table.list-table td.numeric{text-align:right;font-variant-numeric:tabular-nums}
.status-name-link{color:#4f46e5;text-decoration:underline;font-weight:600;display:inline-flex;align-items:center;gap:8px;max-width:100%;min-width:0}
.status-name-link:hover{text-decoration:none}
.partner-name{display:inline-flex;align-items:center;gap:8px}
.status-name-link .name-text,.partner-name .name-text{white-space:normal;display:inline-block;max-width:100%;word-break:break-word;line-height:1.3;}

.commission-table{min-height:64px}
.empty-row td{text-align:center;color:var(--muted);padding:18px 12px}

#goal-progress-card{align-self:flex-start}
#goal-progress-card .goal-progress{gap:10px}
#goal-progress-card .goal-progress .goal-line{margin-bottom:0}
.insight-head{align-items:flex-start}
.insight-actions{margin-left:auto;display:flex;align-items:center;gap:8px}
.insight-actions .btn{font-size:12px;padding:4px 10px}


/* Kanban board */
.kanban-board{width:100%;overflow:auto;max-height:calc(100vh - 220px);padding-bottom:8px}
.kanban-columns{display:flex;gap:14px;align-items:stretch;min-height:240px}
.kanban-column{background:linear-gradient(145deg,#f8fafc,#eef2ff);border:1px solid #e2e8f0;border-radius:18px;padding:14px;min-width:220px;display:flex;flex-direction:column;gap:10px;box-shadow:0 20px 40px rgba(15,23,42,.12)}
.kanban-column-head{display:flex;justify-content:space-between;align-items:center;gap:6px}
.kanban-column-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.35px;color:#334155}
.kanban-column-count{font-size:10px;color:#64748b}
.kanban-drop{display:flex;flex-direction:column;gap:10px;min-height:120px}
.kanban-card{background:#fff;border:1px solid rgba(15,23,42,.08);border-radius:16px;box-shadow:0 16px 32px rgba(15,23,42,.1);padding:12px;display:flex;flex-direction:column;gap:8px;cursor:grab;transition:transform .2s ease,box-shadow .2s ease}
.kanban-card:hover{transform:translateY(-2px);box-shadow:0 20px 40px rgba(15,23,42,.16)}
.kanban-card.dragging{opacity:.6;transform:scale(.97)}
.kanban-card-header{display:flex;align-items:center;gap:12px}
.kanban-card-avatar{width:32px;height:32px;border-radius:12px;background:#eef2ff;color:#3730a3;font-weight:700;display:flex;align-items:center;justify-content:center;letter-spacing:.2px}
.kanban-card-title{flex:1}
.kanban-card-name{font-size:12px;font-weight:700;color:var(--ink)}
.kanban-card-sub{font-size:10px;color:#475569;margin-top:2px}
.kanban-priority{font-size:9px;padding:3px 8px;border-radius:999px;text-transform:uppercase;letter-spacing:.3px;background:#fef3c7;color:#92400e;border:1px solid #fde68a}
.kanban-priority[data-level="warm"]{background:#fef3c7;border-color:#fde68a;color:#b45309}
.kanban-priority[data-level="nurture"]{background:#e0f2fe;border-color:#bae6fd;color:#0c4a6e}
.kanban-priority[data-level="dormant"]{background:#f1f5f9;border-color:#e2e8f0;color:#475569}
.kanban-card-meta{display:flex;flex-wrap:wrap;gap:6px}
.kanban-chip{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;border:1px solid #e2e8f0;background:#f8fafc;font-size:9px;font-weight:600;letter-spacing:.25px;color:#475569}
.kanban-chip.status{text-transform:uppercase;background:#eef2ff;border-color:#c7d2fe;color:#3730a3}
.kanban-chip.partner{background:#ecfdf5;border-color:#bbf7d0;color:#047857;text-transform:none}
.kanban-chip.source{background:#fdf2f8;border-color:#fbcfe8;color:#9d174d;text-transform:none}
.kanban-chip.comms{background:#fefce8;border-color:#fde68a;color:#92400e;text-transform:none}
.kanban-card-foot{display:flex;flex-wrap:wrap;gap:10px;align-items:center;font-size:10px;color:#475569}
.kanban-next-due{display:flex;align-items:center;gap:4px;font-weight:600}
.kanban-next-due.soon{color:#b45309}
.kanban-next-due.late{color:#b91c1c}
.kanban-docs-ok{color:#0f766e;font-weight:600}
.kanban-missing{color:#b91c1c;font-weight:600}
.kanban-last{color:#64748b;font-style:italic}
.kanban-glance{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;align-items:flex-end}
.kanban-glance-chip{display:flex;flex-direction:column;align-items:flex-end;gap:2px;background:#0f172a;color:#fff;padding:8px 12px;border-radius:12px;min-width:110px;box-shadow:0 10px 25px rgba(15,23,42,.35)}
.kanban-glance-chip .label{font-size:10px;letter-spacing:.35px;text-transform:uppercase;opacity:.8}
.kanban-glance-chip strong{font-size:15px}
.kanban-glance-chip em{font-style:normal;font-size:10px;opacity:.75}
.kanban-glance-chip[data-hidden="true"]{opacity:.45}
.kanban-controls{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.badge-stage{font-size:12px;padding:2px 6px;border-radius:8px;border:1px solid #e5e7eb}
@media (max-width:900px){.kanban-columns{gap:12px}.kanban-column{min-width:220px;padding:14px}}


/* Print Suite */
.print-grid{display:grid;gap:12px}
.print-grid.cols-1{grid-template-columns:1fr}
.print-grid.cols-2{grid-template-columns:repeat(2,1fr)}
.print-grid.cols-3{grid-template-columns:repeat(3,1fr)}
.print-grid.cols-4{grid-template-columns:repeat(4,1fr)}
.print-card{border:1px solid #e5e7eb;border-radius:12px;padding:14px;min-height:120px;background:#fff}
.print-card-kind{font-size:12px;color:#64748b;margin-bottom:4px}
.print-card-name{font-size:18px;font-weight:800}
.print-card-date{font-weight:600;margin-top:4px}
.print-card-addr{margin-top:8px;color:#475569;font-size:13px}
@media print{ header, nav, .actionbar, #toast, .badge, .switch, .btn, input, select, textarea { display:none !important } .container{max-width:100%;padding:0} main:not(#view-print){ display:none !important } #view-print{ display:block !important } #print-area{ page-break-inside: avoid } .print-card{ break-inside: avoid; page-break-inside: avoid } }

:focus-visible{outline:2px solid var(--ring);outline-offset:3px}
.card{box-shadow:var(--shadow-card)}


/* Modal (lightweight, no external deps) */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:10000}
.modal.hidden{display:none}
.modal .dlg{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:20px 26px;box-shadow:var(--shadow-card);min-width:min(960px,calc(100vw - 64px));width:min(1200px,calc(100vw - 64px));max-width:1200px;max-height:calc(100vh - 80px);box-sizing:border-box;display:flex;flex-direction:column;margin:0 auto}

.row.wrap{flex-wrap:wrap}
.filter-section{margin-bottom:16px}
.filter-section h4{margin:0 0 6px;font-size:14px;color:var(--ink)}
.filter-options{display:flex;flex-wrap:wrap;gap:10px}
.filter-options label{display:flex;align-items:center;gap:6px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:999px;padding:6px 12px;font-size:12px;color:#475569}
.filter-range{display:flex;gap:10px;flex-wrap:wrap}
.filter-range label{flex:1 1 140px;display:flex;flex-direction:column;gap:4px;font-size:12px;color:#475569;font-weight:600;margin:0}
.filter-range input{padding:6px 8px;border-radius:10px;border:1px solid #dbe3f0;font-size:13px}
.filters-modal-shell{gap:18px}
.filters-header{align-items:flex-start;gap:12px;margin-bottom:8px}
.filters-body{display:flex;gap:18px;align-items:flex-start;flex:1;min-height:0}
.filters-summary{flex:0 0 240px;border:1px solid #e2e8f0;border-radius:14px;background:#f8fafc;padding:14px;display:flex;flex-direction:column;gap:10px;max-height:100%;overflow:auto}
.filters-summary h4{margin:0;font-size:14px;color:var(--ink)}
.filters-summary-empty{font-size:13px;color:#64748b}
.filter-chip-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
.filter-chip{display:flex;flex-wrap:wrap;gap:6px;align-items:center;background:#fff;border:1px solid #cbd5f5;border-radius:10px;padding:8px 10px;font-size:12px;color:#1f2937;box-shadow:0 4px 10px rgba(15,23,42,.08)}
.filter-chip strong{font-weight:600;color:#1e293b}
.filters-content{flex:1;overflow:auto}
.filters-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px}
.filters-footer{justify-content:flex-end;gap:10px;margin-top:16px}
.fine-print{font-size:12px;line-height:1.5}
.local-utilities-grid{display:grid;gap:16px}
.utility-block{border:1px solid #e2e8f0;border-radius:16px;padding:16px;background:#f8fafc;display:flex;flex-direction:column;gap:12px}
.utility-row{display:flex;gap:10px;flex-wrap:wrap}
.utility-row .btn{flex:1 1 160px}
.utility-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.utility-grid .btn{width:100%}
.utility-template-row{gap:10px;align-items:center;flex-wrap:wrap}
.utility-template-row select{min-width:140px}
.import-dialog{gap:16px}
.import-mode-group{border:1px solid #e2e8f0;border-radius:12px;padding:12px 14px;background:#f8fafc;margin:0}
.import-mode-group legend{font-size:12px}
.import-file-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.import-file-row .btn{flex:0 0 auto}
.import-dialog-footer{gap:10px;margin-top:8px}
.restore-mode{display:none}
@media (max-width:860px){
  .filters-body{flex-direction:column}
  .filters-summary{width:100%}
}


/* Floating actionbar (centered) */

/* Click affordances */
td.cell-edit .name{ text-decoration: underline dotted; cursor: pointer; }
.btn-icon{ padding:2px 6px; border-radius:6px; font-size:12px; line-height:1; }
.table tbody tr:hover{ background:rgba(0,0,0,.025); }

tr.status-row{
  position:relative;
  background:var(--row-tint,transparent);
  transition:background-color 120ms ease;
}

tr.status-row::before{
  content:"";
  position:absolute;
  top:0;
  bottom:0;
  left:0;
  width:4px;
  background:var(--row-accent,transparent);
  border-radius:0 6px 6px 0;
  pointer-events:none;
}

tr.status-row:hover{
  background:var(--row-hover,rgba(15,23,42,.04));
}

tr.status-row > td,
tr.status-row > th{
  position:relative;
  z-index:1;
}

/* FORM REPAIRS */
label{ display:block; font-weight:600; color:var(--ink); margin:6px 0 4px; }
label > input, label > select, label > textarea{
  display:block !important;
  width:100%; box-sizing:border-box; padding:8px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; color:#111;
}

label[data-required]{
  position:relative;
  padding-left:18px;
}

label[data-required]::before{
  content:"";
  position:absolute;
  left:0;
  top:0.95em;
  transform:translateY(-50%);
  width:8px;
  height:8px;
  border-radius:999px;
  background:var(--bad);
  box-shadow:0 0 0 2px #fff;
}

label[data-required] > input,
label[data-required] > select,
label[data-required] > textarea{
  box-shadow:inset 0 0 0 1px rgba(220,38,38,.15);
  border-color:rgba(220,38,38,.35);
  background:#fff;
}

label[data-required] > input:focus,
label[data-required] > select:focus,
label[data-required] > textarea:focus{
  border-color:var(--bad);
  box-shadow:0 0 0 3px rgba(220,38,38,.18);
}
dialog{ border:none; border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.15); padding:0; }
dialog .dlg{padding:20px;min-width:min(960px,calc(100vw - 64px));width:min(1200px,calc(100vw - 64px));max-width:1200px;max-height:calc(100vh - 80px);display:flex;flex-direction:column;background:#fff;border-radius:18px;box-sizing:border-box;margin:0 auto}
dialog::backdrop{ background:rgba(0,0,0,.35); }

@media (min-width:1200px){
  .modal .dlg,dialog .dlg{min-width:960px}
}

/* Modal layouts */
.modal-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:0;padding:0 0 12px;border-bottom:1px solid #e2e8f0;flex-wrap:wrap}
.modal-header h3,.modal-header strong,.modal-header .modal-title{margin:0;font-size:18px;letter-spacing:.2px;font-weight:700;color:var(--ink)}
.modal-header .btn{min-width:auto}
.modal-header .btn.ghost{color:#1f2937;border-color:transparent;background:rgba(148,163,184,.12)}
.modal-header .btn.ghost:hover{background:rgba(148,163,184,.2)}
.modal-header-actions{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:flex-end}
.modal-header-actions .btn{min-width:auto}
.modal-body{flex:1;display:flex;flex-direction:column;gap:16px;min-height:0}
.dialog-scroll{flex:1 1 auto;overflow:auto;padding-right:8px;margin-right:-8px;max-height:calc(100vh - 220px);min-height:0}
.modal-footer{display:flex;justify-content:flex-end;gap:10px;margin-top:18px;padding-top:12px;border-top:1px solid #e2e8f0}
.modal-form-shell{display:flex;flex-direction:column;gap:0;min-height:0}
.modal-form-shell label{display:flex;flex-direction:column;gap:6px;margin:0;font-weight:600;color:var(--ink);line-height:1.35;min-width:0;white-space:normal}
.modal-form-shell label>:is(input,select,textarea){margin:0;width:100%}
.modal-footer.form-footer{justify-content:space-between;align-items:center}
.form-footer__start,.form-footer__end{display:flex;align-items:center;gap:10px}
.form-footer__start{margin-right:auto}
.form-footer__end{margin-left:auto}
.record-modal .modal-footer{padding-top:12px}
.record-modal form{display:flex;flex-direction:column;height:100%}

/* ===== FINAL: normal tables (aligned, responsive, no stretch) ===== */

/* Containers never force horizontal scroll by themselves */
.list-wrap, .page-wrap, .content-wrap { max-width: 100%; overflow: visible; }
.table-wrap { max-width: 100%; overflow-x: auto; }

/* Table behaves like a normal data table */
table.list-table { table-layout: fixed; width: 100%; border-collapse: separate; border-spacing: 0; }
table.list-table th,
table.list-table td { box-sizing: border-box; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 10px 8px; vertical-align: middle; }

/* Sticky header inside the same scroll container (no header clones) */
table.list-table thead th { position: sticky; top: 0; background: inherit; z-index: 1; padding: 10px 8px; vertical-align: middle; }

/* Kill any decorative left rail/gutter stealing pixels */
table.list-table tr::before { content: none !important; }

table.list-table td.contact-name,
table.list-table td[data-column="name"] {
  min-width: 220px;
  max-width: 320px;
  white-space: normal;
  padding: 12px 8px !important;
  vertical-align: middle;
  line-height: 1.4;
}

table.list-table td.contact-name .status-name-link,
table.list-table td[data-column="name"] .status-name-link {
  display: inline-flex;
  align-items: flex-start;
  gap: 8px;
  width: 100%;
  max-width: 100%;
  min-width: 0;
}

table.list-table td.contact-name .name-text,
table.list-table td[data-column="name"] .name-text {
  display: block;
  flex: 1 1 auto;
  min-width: 0;
  max-width: 100%;
  overflow: visible;
  white-space: normal;
  text-overflow: clip;
  word-break: break-word;
}

@media (max-width: 720px) {
  table.list-table td.contact-name,
  table.list-table td[data-column="name"] {
    min-width: 160px;
  }
}

table.list-table td.favorite-cell,
table.list-table td[data-column="favorite"] {
  padding-left: 0;
  padding-right: 0;
  text-align: center;
}

table.list-table th:first-child,
table.list-table td:first-child,
table.list-table td[data-column="select"] {
  padding-left: 0;
  padding-right: 0;
  text-align: center;
  vertical-align: middle;
}

/* Column widths (7-col default: [check][star][Name][Loan Type][Amount][Referred By][Last Activity]) */
table.list-table thead th:nth-child(1),
table.list-table tbody td:nth-child(1) { width: 36px; }
table.list-table thead th:nth-child(2),
table.list-table tbody td:nth-child(2) { width: 44px; }

/* Name is the only flexible column  grows/shrinks with window */
table.list-table thead th:nth-child(3),
table.list-table tbody td:nth-child(3) { width: auto; }

/* The rest are readable minimums (no overlap); adjust at breakpoints below */
table.list-table thead th:nth-child(4),
table.list-table tbody td:nth-child(4) { width: 140px; }
table.list-table thead th:nth-child(5),
table.list-table tbody td:nth-child(5) { width: 120px; }
table.list-table thead th:nth-child(6),
table.list-table tbody td:nth-child(6) { width: 160px; }
table.list-table thead th:nth-child(7),
table.list-table tbody td:nth-child(7) { width: 180px; }

/* 6-col variant (lists without Last Activity)  keep the last wide enough */
table.list-table thead th:nth-child(6):last-child,
table.list-table tbody td:nth-child(6):last-child { width: 180px; }

/* Responsive tightening on smaller desktops */
@media (max-width: 1280px) {
  table.list-table thead th:nth-child(4),
  table.list-table tbody td:nth-child(4) { width: 120px; }
  table.list-table thead th:nth-child(6),
  table.list-table tbody td:nth-child(6) { width: 140px; }
  table.list-table thead th:nth-child(7),
  table.list-table tbody td:nth-child(7) { width: 160px; }
}

/* Ultra-narrow fallback: allow horizontal scroll rather than misalignment */
@media (max-width: 1100px) {
  .table-wrap { overflow-x: auto; }
}

table.list-table th[data-column="select"],
table.list-table td[data-column="select"] {
  width: 44px;
  min-width: 44px;
}

/* Ensure select-all checkboxes are visible */
table.list-table th[data-role="select"] input[data-role="select-all"],
table.list-table th input[data-role="select-all"],
table thead th input[data-role="select-all"],
input[data-role="select-all"],
input[data-ui="row-check-all"] {
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 18px !important;
  height: 18px !important;
  margin: 0 auto !important;
  cursor: pointer !important;
  appearance: auto !important;
  -webkit-appearance: checkbox !important;
  -moz-appearance: checkbox !important;
}

/* Ensure row checkboxes are also visible */
input[data-role="select"],
input[data-ui="row-check"] {
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 18px !important;
  height: 18px !important;
  margin: 0 !important;
  cursor: pointer !important;
  appearance: auto !important;
  -webkit-appearance: checkbox !important;
  -moz-appearance: checkbox !important;
}

table.list-table th[data-column="favorite"],
table.list-table td[data-column="favorite"] {
  width: 40px;
  min-width: 40px;
}

table.list-table th[data-column="name"],
table.list-table td[data-column="name"] {
  width: clamp(220px, 32vw, 420px);
  max-width: 440px;
}

table.list-table th[data-column="loanType"],
table.list-table td[data-column="loanType"] {
  width: clamp(140px, 26vw, 220px);
}

table.list-table th[data-column="loanAmount"],
table.list-table td[data-column="loanAmount"] {
  width: 120px;
  min-width: 120px;
}

table.list-table th[data-column="referred"],
table.list-table td[data-column="referred"],
table.list-table th[data-column="owner"],
table.list-table td[data-column="owner"] {
  width: clamp(150px, 28vw, 240px);
}

table.list-table th[data-column="last"],
table.list-table td[data-column="last"],
table.list-table th[data-column="lastTouch"],
table.list-table td[data-column="lastTouch"],
table.list-table th[data-column="updatedAt"],
table.list-table td[data-column="updatedAt"],
table.list-table th[data-column="nextTouch"],
table.list-table td[data-column="nextTouch"],
table.list-table th[data-column="nextAction"],
table.list-table td[data-column="nextAction"] {
  width: clamp(140px, 22vw, 200px);
}

/* Pipeline table specifics */
#tbl-pipeline, #tbl-clients {
  table-layout: auto;
  min-width: 800px;
}

#tbl-pipeline th,
#tbl-pipeline td,
#tbl-clients th,
#tbl-clients td {
  padding: 14px 10px;
  vertical-align: middle;
}

#tbl-pipeline td:nth-child(2),
#tbl-clients td:nth-child(2) {
  white-space: normal;
  min-width: 180px;
  max-width: 280px;
  line-height: 1.4;
}

#tbl-pipeline a,
#tbl-clients a {
  color: var(--brand);
  text-decoration: none;
  font-weight: 500;
  cursor: pointer;
}

#tbl-pipeline a:hover,
#tbl-clients a:hover {
  text-decoration: underline;
}

#tbl-longshots th:nth-child(1),
#tbl-longshots td:nth-child(1) {
  width: 44px;
  min-width: 44px;
}

#tbl-longshots th:nth-child(2),
#tbl-longshots td:nth-child(2) {
  width: 40px;
  min-width: 40px;
  padding-left: 0;
  padding-right: 0;
  text-align: center;
}

#tbl-longshots th:nth-child(3),
#tbl-longshots td:nth-child(3) {
  width: clamp(220px, 32vw, 420px);
  max-width: 440px;
}

#tbl-longshots td:nth-child(3) {
  min-width: 180px;
}

#tbl-longshots th:nth-child(4),
#tbl-longshots td:nth-child(4) {
  width: 120px;
  min-width: 120px;
}

#tbl-longshots th:nth-child(5),
#tbl-longshots td:nth-child(5) {
  width: clamp(150px, 28vw, 220px);
}

#tbl-longshots th:nth-child(6),
#tbl-longshots td:nth-child(6) {
  width: clamp(140px, 24vw, 200px);
}

#tbl-longshots th:nth-child(7),
#tbl-longshots td:nth-child(7) {
  width: clamp(140px, 22vw, 200px);
}

/* ===== FINAL: editor modal  wide, readable, no scrunch ===== */

/* Make the dialog wide on desktop but fluid if screen is smaller */
.record-modal .dlg {
  width: clamp(1040px, 98vw, 1480px);
  max-width: min(98vw, 1480px);
  max-height: min(94vh, calc(100vh - 80px));
}

[data-ui="contact-edit-modal"] .dlg,
[data-ui="partner-edit-modal"] .dlg {
  max-height: min(96vh, calc(100vh - 60px));
}

/* Let the scroll container live on the body so summary + tabs stay aligned */
.record-modal .dialog-scroll {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  max-height: calc(100vh - 208px);
  padding-right: 0;
  margin-right: 0;
}

.record-modal .modal-body {
  flex: 1;
  overflow: auto;
  overscroll-behavior: contain;
  padding-right: 24px;
  margin-right: -24px;
  scrollbar-gutter: stable;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

/* Layout summary + main as a grid; keep children from forcing overflow */
.record-modal .dlg .column,
.record-modal .dlg .grid > *,
.record-modal .dlg [data-ui="right-pane"],
.record-modal .dlg [class*="form"] { min-width: 0; }
.modal-form-layout{display:grid;gap:16px;align-items:flex-start;min-width:0;grid-template-columns:minmax(0,1fr)}
.modal-summary{background:linear-gradient(145deg,#eef2ff,#e0f2fe);border-radius:14px;padding:16px;border:1px solid #dbeafe;box-shadow:0 12px 32px rgba(79,70,229,.12);min-width:0;width:100%;max-width:320px}
.modal-summary h4{margin:0 0 6px;font-size:15px}
.modal-summary .summary-name{font-size:20px;font-weight:700;margin-bottom:4px;letter-spacing:.3px;display:flex;align-items:center;gap:10px}
.modal-summary .summary-meta{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0}
.summary-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600;background:#fff;border:1px solid rgba(79,70,229,.25);color:#312e81;text-transform:capitalize}
.summary-metrics{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:14px}
.summary-metric{background:rgba(255,255,255,.72);border:1px solid rgba(15,23,42,.08);border-radius:12px;padding:10px}
.summary-metric .metric-label{font-size:11px;text-transform:uppercase;letter-spacing:.4px;color:#475569;margin-bottom:4px}
.summary-metric .metric-value{font-size:16px;font-weight:700;color:var(--ink)}
.modal-main{display:grid;grid-template-columns:minmax(0,1fr) minmax(280px,320px);gap:20px;align-items:start;min-width:0}
.modal-main>.modal-core{display:flex;flex-direction:column;gap:16px;min-width:0}
.modal-core .modal-content{display:flex;gap:32px;align-items:flex-start;min-width:0}
.modal-main>[data-ui="contact-detail-pane"]{display:flex;flex-direction:column;gap:16px;min-width:0;max-width:100%;position:relative}
.modal-main>[data-ui="contact-detail-pane"]::before{content:"";position:absolute;inset:-8px -12px -8px -12px;border-radius:18px;z-index:-1;background:linear-gradient(150deg,#eef2ff,#f1f5f9);opacity:.8}
[data-ui="contact-detail-pane"] .detail-card{background:#fff;border:1px solid #dbeafe;border-radius:14px;padding:16px;box-shadow:0 10px 26px rgba(148,163,184,.18);display:flex;flex-direction:column;gap:12px}
[data-ui="contact-detail-pane"] .detail-card h4{margin:0;font-size:14px;letter-spacing:.3px;text-transform:uppercase;color:#1e293b}
.detail-list{display:flex;flex-direction:column;gap:10px;margin:0;padding:0;list-style:none}
.detail-list-row{display:grid;grid-template-columns:max-content minmax(0,1fr);gap:8px;align-items:start}
.detail-list-row dt{font-size:11px;letter-spacing:.3px;text-transform:uppercase;color:#64748b;margin:0}
.detail-list-row dd{margin:0;font-size:13px;font-weight:600;color:#0f172a;word-break:break-word}
.detail-actions{display:flex;flex-wrap:wrap;gap:8px}
.detail-actions .btn{flex:1 1 120px}
.milestone-header{display:flex;flex-direction:column;gap:10px;margin-bottom:16px;padding:14px;border-radius:16px;background:linear-gradient(145deg,#f8fafc,#eef2ff);border:1px solid rgba(148,163,184,.24);box-shadow:0 16px 30px rgba(148,163,184,.16)}
.milestone-header-top{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.milestone-progress{position:relative;flex:1;min-width:160px;height:8px;border-radius:999px;background:rgba(148,163,184,.28);overflow:hidden}
.milestone-progress-fill{position:absolute;inset:0 auto 0 0;width:0;background:linear-gradient(90deg,var(--accent-milestone,#f97316),#facc15);transition:width .25s ease}
.milestone-header .btn.compact{min-width:auto;min-height:32px;padding:6px 12px}
.milestone-badges{display:flex;flex-wrap:wrap;gap:8px}
.milestone-badge{border-radius:999px;border:1px solid rgba(15,23,42,.16);background:#fff;color:#334155;font-size:12px;font-weight:600;padding:6px 12px;cursor:pointer;transition:background .2s ease,color .2s ease,border-color .2s ease,box-shadow .2s ease}
.milestone-badge.is-active{background:var(--accent-milestone,#f97316);border-color:var(--accent-milestone,#f97316);color:#fff;box-shadow:0 0 0 2px rgba(249,115,22,.18)}
.milestone-badge:focus-visible{outline:2px solid var(--focus-ring,#2563eb);outline-offset:2px}
.modal-tabs{display:flex;flex-direction:column;gap:8px;min-width:200px;position:sticky;top:0}
.modal-tabs button{justify-content:flex-start;background:#f8fafc;border:1px solid #e2e8f0;color:#475569;font-weight:500;transition:all .2s ease}
.modal-tabs button:hover{background:#f1f5f9;border-color:#cbd5e1;color:#334155;transform:translateX(2px);box-shadow:0 4px 12px rgba(15,23,42,.08)}
.modal-tabs button.active{background:linear-gradient(135deg,#4f46e5,#6366f1);border-color:#4f46e5;color:#ffffff;font-weight:700;box-shadow:0 8px 24px rgba(79,70,229,.35);transform:translateX(4px)}
.modal-panels{flex:1;display:flex;flex-direction:column;gap:0;min-width:0}
.modal-panels .modal-panel,.modal-panels .modal-section,.modal-panels .field-grid{min-width:0}
.modal-panel{display:none;flex-direction:column;gap:16px}
.modal-panel.active{display:flex}
.stage-slider{margin-top:12px;padding:16px;border:1px solid #d0d7ec;border-radius:18px;background:linear-gradient(145deg,#f8fafc,#eef2ff);display:flex;flex-direction:column;gap:14px;box-shadow:0 18px 32px rgba(79,70,229,.08)}
.stage-slider-track{position:relative;height:12px;border-radius:999px;background:rgba(148,163,184,.28);overflow:hidden}
.stage-slider-progress{position:absolute;height:100%;left:0;top:0;background:linear-gradient(90deg,#6366f1,#22d3ee);border-radius:999px;width:0;transition:width .25s ease;box-shadow:0 6px 18px rgba(79,70,229,.35)}
.stage-slider-marks{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);display:flex;justify-content:space-between;padding:0 2px;pointer-events:none}
.stage-slider-mark{width:18px;height:18px;border-radius:999px;background:#fff;border:2px solid rgba(99,102,241,.35);box-shadow:0 3px 6px rgba(15,23,42,.16);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#475569}
.stage-slider-mark.active{border-color:#4f46e5;color:#312e81;background:#eef2ff;box-shadow:0 6px 14px rgba(79,70,229,.3)}
.stage-slider-labels{display:flex;justify-content:space-between;font-size:11px;text-transform:uppercase;letter-spacing:.35px;color:#334155;font-weight:600}
.stage-slider input[type="range"]{width:100%;appearance:none;background:transparent}
.stage-slider input[type="range"]::-webkit-slider-thumb{appearance:none;width:24px;height:24px;border-radius:999px;background:#4f46e5;border:3px solid #fff;box-shadow:0 4px 8px rgba(79,70,229,.35);cursor:pointer;margin-top:-6px}
.stage-slider input[type="range"]::-moz-range-thumb{width:24px;height:24px;border-radius:999px;background:#4f46e5;border:3px solid #fff;box-shadow:0 4px 8px rgba(79,70,229,.35);cursor:pointer}
.stage-slider input[type="range"]::-webkit-slider-runnable-track{height:12px;appearance:none;background:transparent}
.stage-slider input[type="range"]::-moz-range-track{height:12px;background:transparent}
.stage-slider-help{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:12px 14px;box-shadow:0 12px 28px rgba(15,23,42,.08);line-height:1.45}
.stage-slider-help strong{display:block;font-size:12px;text-transform:uppercase;letter-spacing:.35px;color:var(--ink);margin-bottom:6px}
.stage-slider-help p{margin:0;font-size:12px;color:#475569}
.modal-section{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(15,23,42,.04)}
.modal-section h4{margin:0 0 12px;font-size:15px;text-transform:uppercase;letter-spacing:.4px;color:var(--ink)}
.field-grid{display:grid;gap:12px}
.field-grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.field-grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
.field-grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
.field-grid.wide{grid-template-columns:repeat(1,minmax(0,1fr))}
.modal-note{font-size:12px;color:#475569;margin-top:6px}
.tone-progress{--tone-bg:var(--tone-progress-bg);--tone-border:var(--tone-progress-border);--tone-text:var(--tone-progress-text)}
.tone-success{--tone-bg:var(--tone-success-bg);--tone-border:var(--tone-success-border);--tone-text:var(--tone-success-text)}
.tone-warning{--tone-bg:var(--tone-warning-bg);--tone-border:var(--tone-warning-border);--tone-text:var(--tone-warning-text)}
.tone-danger{--tone-bg:var(--tone-danger-bg);--tone-border:var(--tone-danger-border);--tone-text:var(--tone-danger-text)}
.stage-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600;line-height:1.1;letter-spacing:.2px;text-transform:none;background:var(--tone-bg,var(--stage-qualified));color:var(--tone-text,#0f172a);border:1px solid var(--tone-border,rgba(15,23,42,.08));box-shadow:inset 0 0 0 1px rgba(15,23,42,.05)}
.kanban-card-stage{margin:8px 0 0;display:flex}
.kanban-card-stage .stage-chip{font-size:11px}
.summary-meta [data-role="stage-chip-wrapper"]{display:inline-flex}
.status-table td .stage-chip{font-size:11px}
.status-pill{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600;text-transform:capitalize;line-height:1;background:var(--tone-bg,#eef2ff);color:var(--tone-text,var(--ink));border:1px solid var(--tone-border,transparent);gap:6px}
.summary-actions{display:inline-flex;align-items:center;gap:6px;margin-left:auto}
.summary-actions .btn{padding:6px 10px;font-size:12px}
.summary-actions .favorite-toggle{font-size:20px}
.favorite-cell,
th.favorite-col{width:36px;min-width:36px;text-align:center;padding:0;vertical-align:middle}
.favorite-cell .favorite-toggle{margin:0 auto;display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;line-height:1;padding:8px}
th.favorite-col > span{display:inline-flex;align-items:center;justify-content:center;width:100%;font-size:18px;line-height:1;color:#cbd5f5}
.favorite-toggle{appearance:none;border:none;background:transparent;font-size:18px;line-height:1;color:#cbd5f5;cursor:pointer;transition:color .2s ease,transform .2s ease,background .2s ease;min-width:40px;min-height:40px;padding:8px;border-radius:50%}
.favorite-toggle:hover,.favorite-toggle:focus-visible{color:#f59e0b;transform:translateY(-1px);background:rgba(245,158,11,0.1)}
.favorite-toggle.is-active{color:#f59e0b}
.favorite-toggle:focus-visible{outline:2px solid var(--ring);outline-offset:3px;border-radius:999px}
.status-row.is-favorite{box-shadow:inset 0 0 0 2px rgba(250,204,21,.25);background:rgba(254,243,199,.25)}
.status-row.is-favorite td{background:rgba(254,243,199,.15)}
.modal-summary .summary-name{padding:6px 8px;border-radius:12px;background:rgba(255,255,255,.6)}
.modal-summary .summary-name.is-favorite{background:linear-gradient(145deg,#fefce8,#fef9c3);box-shadow:inset 0 0 0 2px rgba(250,204,21,.35)}
.modal-summary .summary-name .favorite-toggle{font-size:22px}
.insight-icon.favorites{background:linear-gradient(140deg,#fef3c7,#fde68a);color:#92400e}
#favorites-card .empty{border:1px dashed #e2e8f0;border-radius:12px;padding:16px;text-align:center;font-size:13px}
#favorites-card[data-has-favorites="0"] .count-badge{background:#e2e8f0;color:#475569}
.section-subhead{margin:0 0 10px;font-size:13px;text-transform:uppercase;letter-spacing:.35px;color:#475569;font-weight:600}
.field-stack{display:grid;gap:10px}
.linked-summary{font-size:12px;color:#475569}
.linked-customers{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.linked-card{border:1px solid #e2e8f0;border-radius:16px;background:linear-gradient(145deg,#eef2ff,#f8fafc);padding:14px;box-shadow:0 16px 32px rgba(79,70,229,.12);cursor:pointer;transition:transform .2s ease,box-shadow .2s ease,border-color .2s ease}
.linked-card:hover{transform:translateY(-2px);box-shadow:0 22px 48px rgba(79,70,229,.18);border-color:#6366f1}
.linked-header{display:flex;gap:12px;align-items:center}
.linked-avatar{width:36px;height:36px;border-radius:10px;background:#eef2ff;color:#3730a3;font-weight:700;display:flex;align-items:center;justify-content:center;letter-spacing:.2px}
.linked-ident{flex:1}
.linked-name{font-weight:700;color:var(--ink)}
.linked-sub{font-size:12px;color:#475569;margin-top:2px}
.linked-stage{font-size:11px;text-transform:uppercase;letter-spacing:.35px;padding:4px 8px;border-radius:999px;background:#e0f2fe;border:1px solid #bae6fd;color:#075985}
.linked-meta{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px;font-size:12px;color:#475569}
.linked-missing{color:#b91c1c;font-weight:600}
.linked-empty{padding:16px;border:1px dashed #cbd5f5;border-radius:14px;background:#f8fafc}
.doc-automation-grid{display:flex;flex-direction:column;gap:12px}
.doc-automation-summary{display:flex;flex-direction:column;gap:6px}
.doc-chip-list{list-style:none;margin:10px 0 0;padding:0;display:flex;flex-wrap:wrap;gap:8px}
.doc-chip{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:12px;border:1px solid #e2e8f0;background:#f8fafc;font-size:12px;color:#1e293b}
.doc-chip .doc-chip-name{font-weight:600}
.doc-chip .doc-chip-status{font-size:11px;font-weight:700;text-transform:uppercase;color:#475569}
.doc-chip[data-status="requested"],.doc-chip[data-status="pending"]{background:#eff6ff;border-color:#bfdbfe;color:#1d4ed8}
.doc-chip[data-status="received"]{background:#dcfce7;border-color:#bbf7d0;color:#166534}
.doc-automation-actions .btn{flex:0 0 auto}
.doc-missing{font-size:12px;color:#475569}
.doc-missing.warn{color:#b91c1c;font-weight:600}

@media (min-width:1024px){
  /* At desktop widths, lock into a 2-column layout */
  .modal-form-layout{grid-template-columns:minmax(280px,320px) minmax(0,1fr)}
}

@media (max-width:1023px){
  .modal-summary{max-width:100%}
}

@media (max-width:1360px){
  .modal-main{grid-template-columns:minmax(0,1fr) minmax(260px,0.4fr)}
}

@media (max-width:1200px){
  .modal-main{grid-template-columns:minmax(0,1fr)}
  .modal-main>[data-ui="contact-detail-pane"]::before{display:none}
  .modal-main>[data-ui="contact-detail-pane"]{margin-top:12px}
}

@media (max-width:960px){
  .modal-main{grid-template-columns:minmax(0,1fr)}
}

@media (max-width:1080px){
  .field-grid.cols-3{grid-template-columns:repeat(2,minmax(0,1fr))}
  .summary-metrics{grid-template-columns:repeat(2,minmax(0,1fr))}
}
@media (max-width:720px){
  dialog .dlg{min-width:0;width:calc(100vw - 32px)}
  .field-grid.cols-2,.field-grid.cols-3,.field-grid.cols-4{grid-template-columns:repeat(1,minmax(0,1fr))}
  .summary-metrics{grid-template-columns:repeat(1,minmax(0,1fr))}
}

/* Scope calendar to its view only */
main:not(#view-calendar) .calendar-grid{display:none!important}

/* Calendar layout */
#calendar-root{min-height:420px}
.calendar-grid{display:grid;gap:10px}
#calendar-root[data-view="month"] .calendar-grid{grid-template-columns:repeat(7,minmax(0,1fr))}
#calendar-root[data-view="week"] .calendar-grid{grid-template-columns:repeat(7,minmax(0,1fr))}
#calendar-root[data-view="day"] .calendar-grid{grid-template-columns:repeat(1,minmax(0,1fr))}

.cal-cell{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px;min-height:110px;display:flex;flex-direction:column}
.cal-cell.today{border-color:var(--brand);box-shadow:0 0 0 2px rgba(79,70,229,.12)}
.cal-cell.muted{background:#f8fafc;color:var(--muted)}
.cal-cell-head{font-weight:700;font-size:14px;color:var(--ink)}
.calendar-card{display:flex;flex-direction:column;gap:12px}
.cal-events{margin-top:8px;display:flex;flex-direction:column;gap:6px;flex:1;min-height:0}
.ev{display:flex;align-items:flex-start;gap:10px;padding:6px 10px;border-radius:12px;font-size:12px;line-height:1.3;background:#f8fafc;border-left:4px solid #c7d2fe;box-shadow:0 8px 18px rgba(15,23,42,.08);color:var(--ink)}
.ev .ev-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:10px;background:rgba(148,163,184,.16);color:inherit;flex-shrink:0}
.ev .ev-icon svg{width:16px;height:16px}
.ev-text{display:flex;flex-direction:column;gap:2px;flex:1;min-width:0}
.ev-text strong{font-size:12px;font-weight:700;color:var(--ink);white-space:normal}
.ev-sub{font-size:11px;color:#64748b;white-space:normal}
.ev-loan{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:999px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.3px;background:#e2e8f0;color:#475569;margin-top:2px}
.ev-task{border-left-color:#10b981;background:linear-gradient(135deg,rgba(16,185,129,.16),#f0fdf4)}
.ev-deal{border-left-color:#f59e0b;background:linear-gradient(135deg,rgba(245,158,11,.18),#fefce8)}
.ev-followup{border-left-color:#6366f1;background:linear-gradient(135deg,rgba(99,102,241,.18),#eef2ff)}
.ev-closing{border-left-color:#0ea5e9;background:linear-gradient(135deg,rgba(14,165,233,.2),#f0f9ff)}
.ev-funded{border-left-color:#22c55e;background:linear-gradient(135deg,rgba(34,197,94,.2),#ecfdf5)}
.ev-birthday{border-left-color:#a855f7;background:linear-gradient(135deg,rgba(168,85,247,.18),#f5f3ff);color:#4c1d95}
.ev-anniversary{border-left-color:#ec4899;background:linear-gradient(135deg,rgba(236,72,153,.2),#fdf2f8);color:#9d174d}
.ev-loan.loan-purchase{background:#eef2ff;color:#312e81}
.ev-loan.loan-refi{background:#e0f2fe;color:#0c4a6e}
.ev-loan.loan-heloc{background:#dcfce7;color:#166534}
.ev-loan.loan-construction{background:#fef3c7;color:#92400e}
.ev-loan.loan-investor{background:#fee2e2;color:#991b1b}
.ev-loan.loan-reverse{background:#fce7f3;color:#9d174d}
.ev-loan.loan-other{background:#e2e8f0;color:#334155}
.btn-link.more{align-self:flex-start;padding:0;color:var(--brand);font-weight:600}
.calendar-daily-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:10px;background:rgba(148,163,184,.16);color:#1f2937;flex-shrink:0}
.calendar-daily-icon svg{width:18px;height:18px}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="followup"]{background:rgba(59,130,246,.18);color:#1d4ed8}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="closing"]{background:rgba(129,140,248,.2);color:#4338ca}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="funded"]{background:rgba(34,197,94,.18);color:#047857}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="task"]{background:rgba(148,163,184,.22);color:#334155}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="deal"]{background:rgba(99,102,241,.18);color:#3730a3}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="birthday"]{background:rgba(244,114,182,.2);color:#be185d}
:is(.legend-chip .icon,.ev .ev-icon,.calendar-daily-icon)[data-icon="anniversary"]{background:rgba(244,114,182,.18);color:#be123c}

.calendar-legend{display:flex;flex-wrap:wrap;gap:18px;margin:8px 0 16px;padding:10px 12px;border-radius:14px;border:1px solid #e2e8f0;background:#f8fafc}
.calendar-legend .legend-section{display:flex;flex-direction:column;gap:8px;min-width:180px}
.calendar-legend .legend-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.35px;color:#475569}
.legend-chip{display:inline-flex;align-items:center;gap:10px;padding:6px 14px;border-radius:999px;font-size:12px;font-weight:600;background:#fff;border:1px solid rgba(148,163,184,.25);color:#1f2937;box-shadow:0 8px 20px rgba(15,23,42,.1)}
.legend-chip[data-empty="true"]{opacity:.45}
.legend-chip .icon{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:999px;background:rgba(148,163,184,.18);color:#1f2937}
.legend-chip .icon svg{width:16px;height:16px}
.legend-chip.loan{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.3px;padding:4px 8px}
.legend-chip.loan .swatch{width:12px;height:12px;border-radius:999px;background:currentColor;box-shadow:0 0 0 2px rgba(255,255,255,.65)}
.legend-chip.loan.loan-purchase{background:#eef2ff;border-color:#c7d2fe;color:#312e81}
.legend-chip.loan.loan-refi{background:#e0f2fe;border-color:#bae6fd;color:#0c4a6e}
.legend-chip.loan.loan-heloc{background:#dcfce7;border-color:#bbf7d0;color:#166534}
.legend-chip.loan.loan-investor{background:#fee2e2;border-color:#fecaca;color:#991b1b}
.legend-chip.loan.loan-reverse{background:#fce7f3;border-color:#fbcfe8;color:#9d174d}
.legend-chip.loan.loan-other{background:#e2e8f0;border-color:#cbd5f5;color:#334155}
.legend-inline-row{display:flex;justify-content:flex-end;gap:8px}
.legend-popover{position:relative;display:inline-block;font-size:12px}
.legend-popover:not([open])>.legend-content{display:none}
.legend-summary{list-style:none;display:inline-flex;align-items:center;gap:6px;cursor:pointer;padding:4px 10px;border-radius:999px;font-weight:600;color:#1d4ed8;background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.28);transition:background .2s ease,border-color .2s ease}
.legend-summary::-webkit-details-marker{display:none}
.legend-summary:focus-visible{outline:2px solid var(--ring);outline-offset:2px}
.legend-popover[open]>.legend-content{display:flex}
.legend-content{position:absolute;right:0;margin-top:8px;min-width:240px;padding:14px;border-radius:14px;background:#fff;border:1px solid rgba(148,163,184,.35);box-shadow:0 18px 36px rgba(15,23,42,.18);display:flex;flex-direction:column;gap:10px;z-index:20}
.legend-title{font-size:11px;text-transform:uppercase;letter-spacing:.3px;color:#334155}
.legend-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
.legend-item{display:flex;gap:10px;align-items:flex-start}
.legend-item-body{display:flex;flex-direction:column;gap:2px;font-size:12px;color:#334155;line-height:1.35}
.legend-item-title{font-weight:700;color:#0f172a}
.legend-item-desc{font-size:12px;color:#475569}
.legend-swatch{width:14px;height:14px;border-radius:999px;flex:0 0 14px;margin-top:3px;background:var(--legend-swatch-color,#cbd5f5);box-shadow:0 0 0 1px rgba(15,23,42,.12)}
.legend-note{font-size:11px;color:#64748b;margin:0}

.cal-badge{display:block;margin:2px 0;padding:2px 4px;border-radius:4px}
.cal-more{background:none;border:0;cursor:pointer;text-decoration:underline}

/* Hide stray fractional counters injected by legacy pagination, if present */
.page-of, .pagination-info { display:none !important; }

/* hide stray page counters */
.page-of,.pagination-info{display:none!important}
.status-panel summary::after{content:'';margin-left:auto;font-size:12px;color:#475569;transition:transform .2s ease}
.status-panel:not([open]) summary::after{transform:rotate(-90deg)}
/* PATCH: center the action bar without affecting smoke/test selectors */
[data-ui="action-bar"][data-visible="1"] {
  display: flex !important;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;   /* center horizontally */
  gap: 8px;                  /* even spacing between buttons */
  width: 100%;
  margin: 8px auto;
}

/* Keep buttons consistent sizing and prevent layout shift while loading */
[data-ui="action-bar"][data-visible="1"] [data-action] {
  min-height: 32px;
  line-height: 32px;
  padding: 0 10px;
}

/* On narrow viewports, let items wrap cleanly */
@media (max-width: 640px) {
  [data-ui="action-bar"][data-visible="1"] {
    justify-content: center;
    gap: 6px;
  }
  [data-ui="action-bar"][data-visible="1"] [data-action] {
    flex: 0 0 auto;
  }
}

.form-validation-summary {
  margin: 0 0 12px;
  padding: 12px;
  border: 1px solid var(--error-border, #ef4444);
  background: var(--error-soft, #fef2f2);
  color: var(--error-text, #991b1b);
  border-radius: 8px;
  font-weight: 600;
}

.touch-summary {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
  text-align: right;
}

.touch-summary .touch-last {
  font-weight: 700;
}

.touch-summary .touch-recent {
  margin: 0;
  padding-inline-start: 16px;
  color: var(--muted, #64748b);
  font-size: 12px;
}
