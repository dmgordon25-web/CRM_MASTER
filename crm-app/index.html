<!DOCTYPE html>
<html lang="en">

<head>
  <!-- BOOT_STAMP: crm-app-index -->
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect width='16' height='16' rx='3' fill='%233b82f6'/%3E%3Ctext x='8' y='12' text-anchor='middle' font-size='10' fill='white'%3EC%3C/text%3E%3C/svg%3E">
  <style>
    #diagnostics-splash {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      color: #fff;
      padding: 20px;
      z-index: 99999;
    }
  </style>
  <base href="./" />
  <script type="importmap">
  {
    "imports": {
      "crm/": "./js/"
    }
  }
  </script>
  <script src="./js/boot/early_trap.js"></script>
  <script src="./stability_verifier.js"></script>
  <!-- Early theme application (before first paint) -->
  <script>
    (function () {
      try {
        if (/[?&]safe=1/.test(location.search)) return;
        var t = localStorage.getItem('crm:theme');
        if (t && t !== 'classic') document.body.dataset.theme = t;
      } catch (e) { }
    })();
  </script>
  <title>
    THE CRM Tool ‚Äî Modular v1 (Unified v0905 R5 baseline)
  </title>
  <link href="styles.css" rel="stylesheet" />
  <link href="styles/dashboard.css" rel="stylesheet" />
  <link href="styles/loaders.css" rel="stylesheet" />
  <link href="styles/labs.css" rel="stylesheet" />
</head>

<body>
  <!-- BOOT_STAMP: crm-app-index -->
  <div class="boot-splash" id="boot-splash" role="status">
    <div>Loading CRM‚Ä¶</div>
  </div>
  <!-- dev SW/cache killer to prevent stale HTML on 127.0.0.1 -->
  <script>try { if (location.hostname === '127.0.0.1' && 'serviceWorker' in navigator) { navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister())); if (window.caches && caches.keys) caches.keys().then(ks => ks.forEach(k => caches.delete(k))); } } catch { }</script>
  <div id="diagnostics-splash">
    <h3>CRM Diagnostics</h3>
    <p>If this stays visible, boot failed. Logs available via /__log or local logs folder.</p>
    <p><a href="?safe=1" style="color:#a7f3d0">Safe Mode</a></p>
  </div>
  <div class="container">
    <div id="diagnostics" hidden></div>
    <div class="top-shell">
      <header class="row header-bar">
        <h1 class="app-title">
          <a class="title-link" href="#" id="app-title-link">
            <span class="title-main">THE CRM Tool</span>
            <span class="title-sub">Modular v1</span>
            <span class="title-sub accent">Powered by DGO</span>
          </a>
        </h1>
        <div class="grow"></div>
        <div id="global-search-root" style="flex:1;max-width:420px;min-width:260px;margin-right:12px"></div>
        <div class="dropdown header-new-wrap" data-role="header-new-host" style="position:relative;margin-right:8px">
          <button class="btn brand" id="quick-add-unified" type="button" aria-label="Create new record">
            (+ New)
          </button>
        </div>
        <button class="btn" id="btn-open-settings" type="button" aria-label="Open settings">
          Settings
        </button>
        <button class="btn" id="btn-open-help" type="button" aria-label="Open help and quick tour">
          Help
        </button>
        <div id="lo-profile-chip" style="text-align:right;margin-right:12px;min-width:180px">
          <div class="fine-print muted">Loan Officer</div>
          <div data-role="lo-name">Set your profile</div>
          <div class="fine-print muted" data-role="lo-contact">‚Äî</div>
        </div>
        <div class="dropdown" id="notif-wrap" style="position:relative">
          <button aria-label="Notifications" class="btn" id="notif-bell" title="Notifications">
            üîî
            <span class="badge-pill" id="notif-badge" style="display:none;margin-left:6px">
              0
            </span>
          </button>
          <div class="card hidden" id="notif-panel"
            style="position:absolute;right:0;top:42px;min-width:320px;max-height:60vh;overflow:auto">
            <div class="row" style="align-items:center">
              <strong>
                Notifications
              </strong>
              <span class="grow">
              </span>
              <button class="btn danger" id="btn-clear-notifs">
                Clear All
              </button>
            </div>
            <ul class="muted" id="notif-bell-list" style="padding-left:18px">
            </ul>
          </div>
        </div>
      </header>
      <nav class="row" id="main-nav" style="margin-top:12px;align-items:center;gap:8px;flex-wrap:wrap">
        <button class="btn" data-nav="labs" title="Preview of the next-generation dashboard">
          Dashboard (Preview)
          <span aria-hidden="true" style="margin-left:6px;padding:2px 6px;border-radius:10px;background:var(--bg-subtle, #f0f2f5);color:var(--text-muted, #5f6368);font-size:11px;line-height:1;">Preview</span>
        </button>
        <button class="btn active" data-nav="dashboard" title="Your daily overview">
          Dashboard
        </button>
        <button class="btn" data-nav="pipeline">
          Pipeline
        </button>
        <button class="btn" data-nav="contacts">
          Contacts
        </button>
        <button class="btn" data-nav="partners">
          Partners
        </button>
        <button class="btn" data-nav="calendar">
          Calendar
        </button>
        <button class="btn" data-nav="longshots">
          Leads
        </button>
        <button class="btn" data-nav="notifications">
          Notifications
        </button>
        <span class="grow"></span>
        <button class="btn" data-nav="reports">
          Client Portfolio
        </button>
        <button class="btn" data-nav="workbench">
          Workbench
        </button>
      </nav>
    </div>
    <!-- DASHBOARD -->
    <main data-ui="dashboard-root" id="view-dashboard">
      <div class="row" id="dashboard-header" data-dashboard-mode="default" style="align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap">
        <h2 style="margin:0;font-size:18px">Dashboard</h2>
        <span class="muted" id="dashboard-mode-caption">Your daily overview</span>
        <span class="dash-preview-indicator" data-dashboard-preview hidden aria-label="Preview mode">Preview</span>
        <span class="grow"></span>
        <div class="row" role="group" aria-label="Dashboard scope">
          <button class="btn pill active" data-dashboard-mode="today" type="button">Today</button>
          <button class="btn pill" data-dashboard-mode="all" type="button">All</button>
        </div>
        <span class="help-icon" data-help="dashboard-page" aria-label="Dashboard help">?</span>
        <button class="btn subtle dash-layout-customize" data-dashboard-action="layout-customize" type="button"
          aria-pressed="false" aria-label="Customize dashboard layout">Customize</button>
        <div class="row dash-layout-advanced" data-dashboard-advanced role="group" aria-label="Dashboard layout tools">
          <button class="btn subtle dash-layout-toggle" data-dashboard-action="layout-toggle" type="button"
            aria-pressed="false" title="Drag, resize, and reorder dashboard widgets">
            <span data-mode="view">Edit layout</span>
            <span data-mode="edit" hidden>Done editing</span>
          </button>
          <button class="btn subtle dash-layout-reset" data-dashboard-action="layout-reset" type="button"
            title="Restore default dashboard layout">
            <span class="dash-layout-reset-icon" aria-hidden="true">‚Ü∫</span>
            <span>Reset layout</span>
          </button>
        </div>
      </div>
      <section class="card" id="dashboard-focus" data-widget-id="focus"></section>
      <section class="card" id="dashboard-filters" data-widget-id="filters"></section>
      <section class="card" id="dashboard-kpis" data-widget-id="kpis"></section>
      <section class="card" id="dashboard-pipeline-overview" data-widget-id="pipeline"></section>
      <section class="card" id="dashboard-today" data-widget-id="today"></section>
      <section class="card" id="dashboard-todo" data-widget-id="todo">
        <div class="muted">Stay on top of quick tasks and notes.</div>
      </section>
      <section class="card" id="referral-leaderboard" data-widget="leaderboard" data-dash-widget="leaderboard"
        data-widget-id="leaderboard"></section>
      <section class="card" id="dashboard-stale" data-widget-id="stale"></section>
      <section class="grid insights-grid" id="dashboard-insights">
        <div class="card insight-card span-2" id="goal-progress-card" data-widget-id="goalProgress">
          <div class="insight-head">
            <div class="insight-icon goals">üéØ</div>
            <div>
              <h4>Production Goals</h4>
              <p class="muted">Monthly targets versus real progress.</p>
            </div>
          </div>
          <div class="goal-progress">
            <div id="goal-progress-metrics">
              <div class="goal-line">
                <div class="goal-meta">
                  <strong>Funded Loans</strong>
                  <span class="muted" id="goal-funded-label">0 of 0</span>
                </div>
                <div class="goal-bar"><span id="goal-funded-bar"></span></div>
              </div>
              <div class="goal-line">
                <div class="goal-meta">
                  <strong>Loan Volume</strong>
                  <span class="muted" id="goal-volume-label">$0 of $0</span>
                </div>
                <div class="goal-bar"><span id="goal-volume-bar"></span></div>
              </div>
            </div>
            <div class="goal-empty muted" id="goal-empty-state" style="display:none">Set monthly goals in Settings ‚Üí
              Goals to start tracking progress.</div>
            <div class="goal-footnote muted" id="goal-progress-footnote">Targets reset each calendar month.</div>
          </div>
        </div>
        <div class="card insight-card numbers-card" id="numbers-portfolio-card" data-widget-id="numbersPortfolio">
          <div class="insight-head numbers-card-head">
            <div class="insight-icon numbers-portfolio-icon">üìä</div>
            <div>
              <h4>Partner Portfolio</h4>
              <p class="muted">Tier mix across active partners</p>
            </div>
            <span class="count-badge" id="partner-portfolio-count">0</span>
          </div>
          <div class="numbers-card-body">
            <div class="insight-list" id="partner-tier-breakdown">
              ‚Äî
            </div>
          </div>
        </div>
        <div class="card insight-card numbers-card" id="numbers-referrals-card" data-widget-id="numbersReferrals">
          <div class="insight-head numbers-card-head">
            <div class="insight-icon numbers-referrals-icon">üèÜ</div>
            <div>
              <h4>Referral Leaders <span class="help-icon" data-help-id="referral-leaders">?</span></h4>
              <p class="muted">Top partners feeding your funnel</p>
            </div>
          </div>
          <div class="numbers-card-body">
            <ol class="insight-list ranked" id="top3">
            </ol>
          </div>
        </div>
        <div class="card insight-card numbers-card span-2" id="numbers-momentum-card" data-widget-id="numbersMomentum">
          <div class="insight-head numbers-card-head">
            <div class="insight-icon numbers-momentum-icon">üìà</div>
            <div>
              <h4>Pipeline Momentum <span class="help-icon" data-help-id="pipeline-momentum">?</span></h4>
              <p class="muted">Stage distribution at a glance</p>
            </div>
            <span class="count-badge" id="pipeline-momentum-count">0</span>
          </div>
          <div class="numbers-card-body">
            <div class="insight-list stage-breakdown" id="pipeline-breakdown">
              ‚Äî
            </div>
          </div>
        </div>
        <div class="card insight-card span-2" id="pipeline-calendar-card" data-widget-id="pipelineCalendar">
          <div class="insight-head">
            <div class="insight-icon calendar">üóìÔ∏è</div>
            <div>
              <h4>Pipeline Calendar</h4>
              <p class="muted">Keep a pulse on the next 30 days</p>
            </div>
            <div class="insight-actions">
              <button class="btn pill" data-ics-source="pipeline-calendar">Export .ics</button>
            </div>
          </div>
          <div class="pipeline-calendar" id="pipeline-calendar">
            <div class="empty muted">Upcoming milestones will appear here once scheduled.</div>
          </div>
        </div>
        <div class="card insight-card" id="priority-actions-card" data-widget="priorityActions"
          data-dash-widget="priorityActions" data-widget-id="priorityActions">
          <div class="insight-head">
            <div class="insight-icon tasks">‚ö°</div>
            <div>
              <h4>Priority Actions <span class="help-icon" data-help-id="priority-actions">?</span></h4>
              <p class="muted">Overdue & high-impact follow-ups</p>
            </div>
            <div class="insight-actions">
              <button class="btn pill" data-ics-source="priority-actions">Export .ics</button>
            </div>
          </div>
          <ul class="insight-list actionable" id="needs-attn">
          </ul>
        </div>
        <div class="card insight-card" id="milestones-card" data-widget="milestonesAhead"
          data-dash-widget="milestonesAhead" data-widget-id="milestones">
          <div class="insight-head">
            <div class="insight-icon timeline">üìå</div>
            <div>
              <h4>Milestones Ahead <span class="help-icon" data-help-id="milestones">?</span></h4>
              <p class="muted">Upcoming events & touchpoints</p>
            </div>
            <div class="insight-actions">
              <button class="btn pill" data-ics-source="milestones">Export .ics</button>
            </div>
          </div>
          <ul class="insight-list timeline" id="upcoming">
          </ul>
        </div>
        <div class="card insight-card" id="doc-pulse-card" data-widget-id="docPulse">
          <div class="insight-head">
            <div class="insight-icon docs">üìÇ</div>
            <div>
              <h4>Document Pulse <span class="help-icon" data-help-id="doc-pulse">?</span></h4>
              <p class="muted">Outstanding requests across clients</p>
            </div>
          </div>
          <div class="doc-status" id="doc-status-summary">
          </div>
        </div>
      </section>
      <section class="grid opportunities-grid" id="dashboard-opportunities" style="margin-top:12px">
        <div class="card insight-card" id="rel-opps-card" data-widget-id="relationshipOpportunities">
          <div class="insight-head">
            <div class="insight-icon relationships">üìû</div>
            <div>
              <h4>Relationship Opportunities</h4>
              <p class="muted">Pipeline borrowers needing a touch</p>
            </div>
            <div class="insight-actions">
              <button class="btn pill" data-ics-source="rel-opps">Export .ics</button>
            </div>
          </div>
          <ul class="insight-list spotlight" id="rel-opps">
            ‚Äî
          </ul>
        </div>
        <div class="card insight-card" id="nurture-card" data-widget-id="clientCareRadar">
          <div class="insight-head">
            <div class="insight-icon nurture">üíô</div>
            <div>
              <h4>Client Care Radar</h4>
              <p class="muted">Funded clients ready for a nurture</p>
            </div>
            <div class="insight-actions">
              <button class="btn pill" data-ics-source="nurture">Export .ics</button>
            </div>
          </div>
          <ul class="insight-list spotlight" id="nurture">
            ‚Äî
          </ul>
        </div>
        <div class="card insight-card" id="closing-watch-card" data-widget-id="closingWatch">
          <div class="insight-head">
            <div class="insight-icon closing">üõéÔ∏è</div>
            <div>
              <h4>Closing Watchlist</h4>
              <p class="muted">Deals approaching the finish line</p>
            </div>
            <div class="insight-actions">
              <button class="btn pill" data-ics-source="closing-watch">Export .ics</button>
            </div>
          </div>
          <ul class="insight-list spotlight" id="closing-watch">
            ‚Äî
          </ul>
        </div>
        <div class="card insight-card" id="favorites-card" data-has-favorites="0" data-widget-id="favorites">
          <div class="insight-head">
            <div class="insight-icon favorites">‚≠ê</div>
            <div>
              <h4>Favorites</h4>
              <p class="muted">Starred partners and contacts</p>
            </div>
            <span class="count-badge" data-role="favorites-count">0</span>
          </div>
          <ul class="insight-list spotlight" data-role="favorites-list" id="favorites-list" hidden>
          </ul>
          <div class="empty muted" data-role="favorites-empty">Star a contact or partner to pin them here.</div>
        </div>
      </section>
      <section class="card" id="doc-center-card" data-widget-id="docCenter">
        <div class="row" style="align-items:center;gap:8px;margin-bottom:6px">
          <p class="widget-summary muted" style="margin:0">Manage document checklists and outstanding requests.</p>
          <span class="help-icon" data-help="doc-center-widget">?</span>
        </div>
        <div class="doc-center" id="doc-center"></div>
      </section>
    </main>
    <!-- LABS -->
    <main class="hidden" data-ui="labs-root" id="view-labs">
      <section class="card" data-qa="labs-shell-placeholder">
        <div class="row" style="align-items:center;gap:8px;margin-bottom:6px">
          <h3 style="margin:0">Dashboard (Preview) <span class="help-icon" data-help-id="labs-view">?</span></h3>
          <span class="muted">Preview of the next-generation dashboard.</span>
        </div>
        <p class="muted">Loading Dashboard (Preview)‚Ä¶</p>
      </section>
    </main>
    <!-- PARTNERS -->
    <main class="hidden" data-ui="partners-table" id="view-partners">
      <section class="card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Partners
          </strong>
          <span class="help-icon" data-help-id="partners-view">?</span>
          <span class="grow">
          </span>
          <button class="btn" data-export-table="partners" aria-label="Export to CSV" title="Export to CSV">Export
            CSV</button>
          <button class="btn" id="btn-filters-partners">
            Filters
          </button>
        </div>
        <div class="row query-save-row">
          <select id="views-partners">
          </select>
          <button class="btn" id="btn-saveview-partners">
            Save Query
          </button>
          <button class="btn danger" id="btn-delview-partners">
            Delete
          </button>
        </div>
        <div class="query-shell" data-query-scope="partners"></div>
        <div class="table-search">
          <input aria-label="Search partners" data-table-search="#tbl-partners" placeholder="Search Partners"
            type="search" />
        </div>
        <table class="table list-table" data-selection-scope="partners" id="tbl-partners">
          <thead>
            <tr>
              <th data-role="select" data-column="select" style="width:44px;text-align:center;">
                <input aria-label="Select all" data-ui="row-check-all" data-role="select-all" id="partners-all"
                  type="checkbox" />
              </th>
              <th>
                <button class="sort-btn" data-key="name" type="button">Name <span aria-hidden="true"
                    class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="company" type="button">Company <span aria-hidden="true"
                    class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="tier" type="button">Tier <span aria-hidden="true"
                    class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="referrals" data-type="number" type="button">Referrals <span
                    aria-hidden="true" class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="funded" data-type="number" type="button">Funded <span
                    aria-hidden="true" class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="active" data-type="number" type="button">Active <span
                    aria-hidden="true" class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="volume" data-type="number" type="button">Volume <span
                    aria-hidden="true" class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="conversion" data-type="number" type="button">Conversion <span
                    aria-hidden="true" class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="email" type="button">Email <span aria-hidden="true"
                    class="sort-icon">‚Üï</span></button>
              </th>
              <th>
                <button class="sort-btn" data-key="phone" type="button">Phone <span aria-hidden="true"
                    class="sort-icon">‚Üï</span></button>
              </th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </section>
    </main>
    <!-- PIPELINE -->
    <main class="hidden" data-ui="kanban-root" id="view-pipeline">
      <section class="card" id="kanban-card">
        <div class="row" style="align-items:center;gap:8px;margin-bottom:6px">
          <h3 style="margin:0">
            Pipeline Kanban
          </h3>
          <span class="help-icon" data-help-id="pipeline-view">?</span>
          <span class="muted">
            Drag contacts across Application ‚Üí Processing ‚Üí Underwriting.
          </span>
          <span class="grow">
          </span>
          <div id="kanban" style="margin:12px 0;"></div>
          <div class="kanban-controls">
            <label class="switch">
              <input id="kb-show-clients" type="checkbox" />
              <span class="muted">
                Show Clients lane
              </span>
            </label>
            <button class="btn" id="kb-reload">
              Refresh
            </button>
          </div>
        </div>
        <div class="kanban-wrap" id="kanban-area">
        </div>
      </section>
      <section class="grid cols-2">
        <div class="card">
          <div class="row" style="align-items:center;gap:12px;margin-bottom:8px;">
            <h3 style="margin:0;">Application / Processing / Underwriting</h3>
            <span class="grow"></span>
            <button class="btn" data-export-table="pipeline" aria-label="Export to CSV" title="Export to CSV">Export
              CSV</button>
          </div>
          <div class="table-search">
            <input aria-label="Search pipeline" data-table-search="#tbl-pipeline" placeholder="Search Pipeline"
              type="search" />
          </div>
          <table class="table list-table" data-selection-scope="pipeline" id="tbl-pipeline">
            <thead>
              <tr>
                <th data-role="select" data-column="select" style="width:44px;text-align:center;">
                  <input aria-label="Select all" data-ui="row-check-all" data-role="select-all" id="pipe-all"
                    type="checkbox" />
                </th>
                <th>
                  Name
                </th>
                <th>
                  Stage
                </th>
                <th>
                  Loan Type
                </th>
                <th>
                  Amount
                </th>
                <th>
                  Referred By
                </th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
        <div class="card">
          <div class="row" style="align-items:center;gap:12px;margin-bottom:8px;">
            <h3 style="margin:0;">Clients (Approved / <abbr title="Cleared to Close">CTC</abbr> / Funded)</h3>
            <span class="grow"></span>
            <button class="btn" data-export-table="clients" aria-label="Export to CSV" title="Export to CSV">Export
              CSV</button>
          </div>
          <div class="table-search">
            <input aria-label="Search clients" data-table-search="#tbl-clients" placeholder="Search Clients"
              type="search" />
          </div>
          <table class="table list-table" data-selection-scope="pipeline" id="tbl-clients">
            <thead>
              <tr>
                <th data-role="select" data-column="select" style="width:44px;text-align:center;">
                  <input aria-label="Select all" data-ui="row-check-all" data-role="select-all" id="clients-all"
                    type="checkbox" />
                </th>
                <th>
                  Name
                </th>
                <th>
                  Stage
                </th>
                <th>
                  Loan Type
                </th>
                <th>
                  Amount
                </th>
                <th>
                  Funded
                </th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </section>
    </main>
    <!-- CONTACTS -->
    <main class="hidden" id="view-contacts">
      <section class="card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px;flex-wrap:wrap">
          <strong>
            Contacts
          </strong>
          <span class="help-icon" data-help-id="contacts-view">?</span>
          <span class="grow">
          </span>
          <button class="btn" data-export-table="contacts" aria-label="Export to CSV" title="Export to CSV">
            Export CSV
          </button>
        </div>
        <div class="table-search">
          <input aria-label="Search contacts" data-table-search="#tbl-contacts" placeholder="Search Contacts"
            type="search" />
        </div>
        <div class="table-wrap">
          <table class="table list-table" data-selection-scope="contacts" id="tbl-contacts">
            <thead>
              <tr>
                <th data-role="select" data-column="select" style="width:44px;text-align:center;">
                  <input aria-label="Select all" data-ui="row-check-all" data-role="select-all" id="contacts-all"
                    type="checkbox" />
                </th>
                <th>
                  Name
                </th>
                <th>
                  Stage
                </th>
                <th>
                  Loan Type
                </th>
                <th>
                  Amount
                </th>
                <th>
                  Email
                </th>
                <th>
                  Phone
                </th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </section>
    </main>
    <!-- TEMPLATES / COMMS (Phase 5) -->
    <main class="hidden" id="view-templates">
      <section class="card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Templates &amp; Comms
          </strong>
          <span class="badge-pill">
            Phase 5
          </span>
          <span class="grow">
          </span>
          <button class="btn" id="btn-add-doc-template" aria-label="Create new document template"
            title="Create new document template">
            New Doc Template
          </button>
          <button class="btn" id="btn-add-msg-template" aria-label="Create new message template"
            title="Create new message template">
            New Message Template
          </button>
          <button class="btn" id="btn-export-templates">
            Export
          </button>
          <button class="btn" id="btn-import-templates">
            Import
          </button>
        </div>
        <div class="grid cols-2">
          <div class="card">
            <h3>
              Document Templates (per loan type)
            </h3>
            <div class="table-search">
              <input aria-label="Search document templates" data-table-search="#tbl-doc-templates"
                placeholder="Search Document Templates" type="search" />
            </div>
            <table class="table" id="tbl-doc-templates">
              <thead>
                <tr>
                  <th>
                    Name
                  </th>
                  <th>
                    Loan Type
                  </th>
                  <th>
                    Items
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
          <div class="card">
            <h3>
              Message Templates
            </h3>
            <div class="muted" style="margin-top:-6px;margin-bottom:8px">
              Tokens:
              <code>
         {first}
        </code>
              <code>
         {loanType}
        </code>
              <code>
         {missingDocs}
        </code>
              <code>
         {partnerName}
        </code>
            </div>
            <div class="table-search">
              <input aria-label="Search message templates" data-table-search="#tbl-msg-templates"
                placeholder="Search Message Templates" type="search" />
            </div>
            <table class="table" id="tbl-msg-templates">
              <thead>
                <tr>
                  <th>
                    Name
                  </th>
                  <th>
                    Context
                  </th>
                  <th>
                    Preview
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
    <!-- Template Editor Modal -->
    <!-- Compose Modal -->
    <dialog id="compose-modal">
      <div class="dlg">
        <div class="row" style="align-items:center">
          <h3 style="margin:0">
            Compose
          </h3>
          <span class="grow">
          </span>
          <button class="btn" id="btn-compose-close">
            Close
          </button>
        </div>
        <div class="grid cols-2" style="margin-top:10px">
          <div>
            <label>
              Template
              <select id="compose-template">
              </select>
            </label>
            <label>
              To
              <input id="compose-to" placeholder="contact email or phone" />
            </label>
            <label>
              Preview
              <textarea id="compose-preview" readonly=""></textarea>
            </label>
          </div>
          <div>
            <label>
              Notes
              <textarea id="compose-notes"></textarea>
            </label>
            <div class="muted">
              Sends are not implemented; this creates a task and logs activity.
            </div>
          </div>
        </div>
        <div class="row" style="justify-content:flex-end;gap:8px;margin-top:12px">
          <button class="btn brand" id="btn-compose-create">
            Create Task
          </button>
        </div>
      </div>
    </dialog>
    <!-- LEADS -->
    <main class="hidden" data-ui="longshots-root" id="view-longshots">
      <section class="card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Leads
          </strong>
          <span class="grow">
          </span>
          <button class="btn" data-export-table="longshots" aria-label="Export to CSV" title="Export to CSV">Export
            CSV</button>
          <button class="btn" id="btn-filters-longshots">
            Filters
          </button>
        </div>
        <div class="row query-save-row">
          <select id="views-longshots">
          </select>
          <button class="btn" id="btn-saveview-longshots">
            Save Query
          </button>
          <button class="btn danger" id="btn-delview-longshots">
            Delete
          </button>
        </div>
        <div class="query-shell" data-query-scope="longshots"></div>
        <div class="table-search">
          <input aria-label="Search leads" data-table-search="#tbl-longshots" placeholder="Search Leads"
            type="search" />
        </div>
        <table class="table list-table" data-selection-scope="pipeline" id="tbl-longshots">
          <thead>
            <tr>
              <th data-role="select" data-column="select" style="width:44px;text-align:center;">
                <input aria-label="Select all" data-ui="row-check-all" data-role="select-all" id="ls-all"
                  type="checkbox" />
              </th>
              <th data-column="name">
                Name
              </th>
              <th data-column="loanType">
                Loan Type
              </th>
              <th class="numeric" data-column="loanAmount">
                Amount
              </th>
              <th data-column="referred">
                Referred By
              </th>
              <th data-column="last">
                Last Activity
              </th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </section>
    </main>
    <!-- CALENDAR / REPORTS / COMMISSIONS (stubs wired to data) -->
    <main class="hidden" id="view-calendar" style="min-height:320px">
      <section class="card calendar-card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Calendar
          </strong>
          <span class="help-icon" data-help-id="calendar-view">?</span>
          <div aria-label="view" class="btn-group" role="group">
            <button class="btn pill" data-calview="month" type="button">
              Month
            </button>
            <button class="btn pill" data-calview="week" type="button">
              Week
            </button>
            <button class="btn pill" data-calview="day" type="button">
              Day
            </button>
          </div>
          <span id="calendar-label" style="font-size:20px;font-weight:700;color:var(--ink,#1e293b);margin-left:8px">
          </span>
          <div class="row" style="gap:8px;align-items:center;margin-left:8px">
            <button class="btn" id="cal-prev" type="button" title="Previous" aria-label="Previous">
              ‚óÄ
            </button>
            <button class="btn" id="cal-today" type="button" title="Today" aria-label="Today">
              Today
            </button>
            <button class="btn" id="cal-next" type="button" title="Next" aria-label="Next">
              ‚ñ∂
            </button>
          </div>
          <span class="grow">
          </span>
          <div class="row" style="gap:8px;align-items:center">
            <button class="btn" data-ui="calendar-export-ics" type="button">
              Export .ics
            </button>
            <button class="btn" data-ui="calendar-export-csv" type="button" aria-label="Export calendar to CSV"
              title="Export calendar to CSV">
              Export CSV
            </button>
          </div>
        </div>
        <div id="calendar-root" style="min-height:480px">
        </div>
      </section>
    </main>
    <main class="hidden" id="view-reports">
      <div class="row" style="align-items:center;gap:12px;margin:12px 0 18px">
        <button class="pill" id="dash-range">
          All Time ‚ñæ
        </button>
        <span class="muted" style="font-size:12px">
          Applies to portfolio KPIs and insights.
        </span>
        <span class="grow">
        </span>
      </div>
      <section class="grid kpi portfolio-kpis">
        <div class="card">
          <div class="kval" id="kpi-total">
            0
          </div>
          <div class="muted">
            Total Contacts
          </div>
          <p class="widget-summary muted">How many people are currently tracked in your CRM.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-loanvol">
            $0
          </div>
          <div class="muted">
            Loan Volume
          </div>
          <p class="widget-summary muted">Sum of active loans currently in your pipeline.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-conv">
            0%
          </div>
          <div class="muted">
            Conversion Rate
          </div>
          <p class="widget-summary muted">Share of total contacts that have funded.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-funded">
            0
          </div>
          <div class="muted">
            Clients Funded
          </div>
          <p class="widget-summary muted">Borrowers who have reached the funded stage.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-comm-pipeline">
            $0
          </div>
          <div class="muted">
            Comm. Pipeline
          </div>
          <p class="widget-summary muted">Projected commissions tied to in-flight deals.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-comm-earned">
            $0
          </div>
          <div class="muted">
            Comm. Earned
          </div>
          <p class="widget-summary muted">Estimated commissions earned based on funded loans.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-comm-received">
            $0
          </div>
          <div class="muted">
            Comm. Received
          </div>
          <p class="widget-summary muted">Money marked as received in your commission tracker.</p>
        </div>
        <div class="card">
          <div class="kval" id="kpi-comm-proj">
            $0
          </div>
          <div class="muted">
            Comm. Projected
          </div>
          <p class="widget-summary muted">Future commissions expected from forecasted deals.</p>
        </div>
      </section>
      <section class="card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Client Portfolio &amp; Earnings
          </strong>
          <span class="help-icon" data-help-id="reports-view">?</span>
          <span class="grow">
          </span>
          <label>
            Range
            <select id="rep-range">
              <option value="tm">
                This Month
              </option>
              <option value="lm">
                Last Month
              </option>
              <option value="tq">
                This Quarter
              </option>
              <option value="ytd">
                YTD
              </option>
              <option value="all">
                All
              </option>
              <option value="custom">
                Custom...
              </option>
            </select>
          </label>
          <label>
            Start
            <input disabled="" id="rep-start" type="date" />
          </label>
          <label>
            End
            <input disabled="" id="rep-end" type="date" />
          </label>
          <button class="btn" id="rep-apply">
            Apply
          </button>
          <button class="btn" id="rep-export" aria-label="Export report results to CSV"
            title="Export report results to CSV">
            Export CSV
          </button>
        </div>
        <div class="grid cols-3">
          <div class="card">
            <div class="muted">
              Funded (Count)
            </div>
            <div class="kval" id="rep-funded-count">
              0
            </div>
          </div>
          <div class="card">
            <div class="muted">
              Funded Volume
            </div>
            <div class="kval" id="rep-funded-sum">
              $0
            </div>
          </div>
          <div class="card">
            <div class="muted">
              Pipeline (Open)
            </div>
            <div class="kval" id="rep-pipeline-open">
              0
            </div>
          </div>
        </div>
        <section class="card" id="reports-root"></section>
        <div class="card" style="margin-top:12px">
          <div class="portfolio-card-header">
            <h3 class="portfolio-card-title" title="Referral Partner Performance">
              Referral Partner Performance
              <span class="help-icon" data-help="portfolio-referrals">?</span>
            </h3>
            <div class="table-search">
              <input aria-label="Search partners" data-table-search="#tbl-referral-performance"
                placeholder="Search Partners" type="search" />
            </div>
          </div>
          <p class="widget-summary muted">Track which partners are sending quality leads and closing loans. Your #1
            business metric.</p>
          <div class="table-wrap portfolio-table-wrap">
            <table class="table portfolio-table" id="tbl-referral-performance">
              <thead>
                <tr>
                  <th>Partner</th>
                  <th>Tier</th>
                  <th>Leads Sent</th>
                  <th>Applications</th>
                  <th>Funded</th>
                  <th>Conversion %</th>
                  <th>Total Volume</th>
                </tr>
              </thead>
              <tbody>
                <tr class="empty-row">
                  <td colspan="7">Loading partner metrics...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card" style="margin-top:12px">
          <div class="portfolio-card-header">
            <h3 class="portfolio-card-title" title="Funded Deals in Range">
              Funded Deals in Range
              <span class="help-icon" data-help="portfolio-funded">?</span>
            </h3>
            <div class="table-search">
              <input aria-label="Search funded deals" data-table-search="#tbl-funded" placeholder="Search Funded Deals"
                type="search" />
            </div>
          </div>
          <div class="table-wrap portfolio-table-wrap">
            <table class="table portfolio-table" id="tbl-funded">
              <colgroup>
                <col class="portfolio-col-name" />
                <col class="portfolio-col-type" />
                <col class="portfolio-col-amount" />
                <col class="portfolio-col-date" />
                <col class="portfolio-col-partner" />
              </colgroup>
              <thead>
                <tr>
                  <th>
                    Name
                  </th>
                  <th>
                    Loan Type
                  </th>
                  <th>
                    Amount
                  </th>
                  <th>
                    Funded Date
                  </th>
                  <th>
                    Partner
                  </th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </section>
      <section class="card" id="commissions-summary-card" style="margin-top:12px">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>Commission Snapshot</strong>
          <label>
            Month
            <input id="comm-month" type="month" />
          </label>
          <span class="grow"></span>
          <button class="btn" id="btn-comm-export" aria-label="Export commission snapshot to CSV"
            title="Export commission snapshot to CSV">Export CSV</button>
        </div>
        <div class="commission-table" id="comm-table"></div>
      </section>
      <section class="card" id="commissions-ledger" style="margin-top:12px">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Commissions Ledger
          </strong>
          <span class="grow">
          </span>
          <label>
            Range
            <select id="led-range">
              <option value="tm">
                This Month
              </option>
              <option value="lm">
                Last Month
              </option>
              <option value="tq">
                This Quarter
              </option>
              <option value="ytd">
                YTD
              </option>
              <option value="all">
                All
              </option>
              <option value="custom">
                Custom...
              </option>
            </select>
          </label>
          <label>
            Start
            <input disabled="" id="led-start" type="date" />
          </label>
          <label>
            End
            <input disabled="" id="led-end" type="date" />
          </label>
          <button class="btn" id="led-apply">
            Apply
          </button>
          <button class="btn" id="led-export" aria-label="Export ledger to CSV" title="Export ledger to CSV">
            Export CSV
          </button>
        </div>
        <div class="grid cols-2">
          <div class="card">
            <h3>
              Received (funded in range)
            </h3>
            <div class="table-search">
              <input aria-label="Search received ledger" data-table-search="#tbl-ledger-received"
                placeholder="Search Received" type="search" />
            </div>
            <table class="table" id="tbl-ledger-received">
              <thead>
                <tr>
                  <th>
                    Paid
                  </th>
                  <th>
                    Name
                  </th>
                  <th>
                    Loan Type
                  </th>
                  <th>
                    Amount
                  </th>
                  <th>
                    Funded
                  </th>
                  <th>
                    Partner
                  </th>
                </tr>
              </thead>
              <tbody>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3">
                    <strong>
                      Totals
                    </strong>
                  </td>
                  <td id="led-rec-sum">
                    $0
                  </td>
                  <td colspan="2">
                  </td>
                </tr>
              </tfoot>
            </table>
            <div class="muted" style="margin-top:6px">
              Paid flags stored in Settings (`commissionFlags`).
            </div>
          </div>
          <div class="card">
            <h3>
              Projected (open pipeline)
            </h3>
            <div class="table-search">
              <input aria-label="Search projected ledger" data-table-search="#tbl-ledger-projected"
                placeholder="Search Projected" type="search" />
            </div>
            <table class="table" id="tbl-ledger-projected">
              <thead>
                <tr>
                  <th>
                    Name
                  </th>
                  <th>
                    Stage
                  </th>
                  <th>
                    Loan Type
                  </th>
                  <th>
                    Amount
                  </th>
                  <th>
                    Partner
                  </th>
                </tr>
              </thead>
              <tbody>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3">
                    <strong>
                      Totals
                    </strong>
                  </td>
                  <td id="led-proj-sum">
                    $0
                  </td>
                  <td>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </section>
    </main>
    <main class="hidden" id="view-workbench">
      <section class="card" id="workbench-root"></section>
    </main>
    <main class="hidden" id="view-notifications" data-selection-scope="notifications">
      <section class="card" id="notifications-shell">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>Notifications Center</strong>
          <span class="help-icon" data-help="notifications-view" aria-label="How notifications behave" role="button" tabindex="0">?</span>
          <span class="badge-pill" id="notifications-count-pill" style="display:none"></span>
          <div class="grow"></div>
          <button class="btn" id="notifications-export" aria-label="Export notifications to CSV"
            title="Export notifications to CSV">Export CSV</button>
        </div>
        <div class="muted" id="notifications-subhead">Queued notifications respect daily throttles per contact/event.
        </div>
        <div id="notif-filters" class="row" style="gap:12px;margin:12px 0;align-items:flex-end"></div>
        <div id="notif-bulkbar" class="row" style="gap:12px;margin:12px 0;align-items:center"></div>
        <div id="notif-center-list"></div>
      </section>
    </main>
    <!-- PRINT SUITE (Phase 8) -->
    <main class="hidden" id="view-print">
      <section class="card">
        <div class="row" style="align-items:center;gap:12px;margin-bottom:8px">
          <strong>
            Print Suite
          </strong>
          <span class="badge-pill">
            Phase 8
          </span>
          <span class="grow">
          </span>
          <label>
            Type
            <select id="print-type">
              <option value="birthdays">
                Birthdays
              </option>
              <option value="anniversaries">
                Anniversaries
              </option>
              <option value="both">
                Both
              </option>
            </select>
          </label>
          <label>
            Range
            <select id="print-range">
              <option value="month">
                This Month
              </option>
              <option value="next30">
                Next 30 Days
              </option>
              <option value="all">
                All
              </option>
            </select>
          </label>
          <label>
            Cards/Row
            <select id="print-cols">
              <option>
                1
              </option>
              <option>
                2
              </option>
              <option selected="">
                3
              </option>
              <option>
                4
              </option>
            </select>
          </label>
          <label class="switch">
            <input id="print-address" type="checkbox" />
            <span>
              Include Address
            </span>
          </label>
          <button class="btn" id="btn-print-generate">
            Generate
          </button>
          <button class="btn brand" id="btn-print">
            Print
          </button>
        </div>
        <div class="muted" id="print-summary" style="margin-bottom:8px">
          ‚Äî
        </div>
        <div class="print-grid" id="print-area">
        </div>
      </section>
    </main>

    <!-- SETTINGS -->
    <main class="hidden" id="view-settings">
      <div class="row" style="align-items:center;gap:8px;margin-bottom:10px">
        <h2 style="margin:0">Settings <span class="help-icon" data-help="settings-view">?</span></h2>
        <span class="muted" style="font-size:12px">Changes save locally as you go.</span>
      </div>
      <div class="settings-shell">
        <nav aria-label="Settings sections" class="settings-nav" id="settings-nav">
          <button class="btn active" data-panel="general">General</button>
          <button class="btn" data-panel="data">Data Tools</button>
          <button class="btn" data-panel="automation">Email Draft Prompts</button>
          <button class="btn" data-panel="dashboard">Dashboard</button>
          <button class="btn" data-panel="goals">Goals</button>
          <button class="btn" data-panel="profile">Profile</button>
          <button class="btn" data-panel="signatures">Signatures</button>
        </nav>
        <div class="settings-panels">
          <section class="settings-panel active" data-panel="general">
            <header class="panel-head">
              <h2>General</h2>
              <p class="muted">Configure personal preferences and system maintenance.</p>
            </header>
            <div class="settings-panel-grid">
              <div class="card">
                <h3>Preferences</h3>
                <p class="widget-summary muted">Adjust your display and background automation defaults.</p>
                <label style="margin-top:8px">
                  Theme
                  <select id="select-theme" style="margin-top:4px">
                    <option value="classic">Classic (Default)</option>
                    <option value="ocean">Ocean Blue</option>
                    <option value="fresh">Fresh Green</option>
                    <option value="slate">Slate Blue-Green</option>
                    <option value="dark">Dark</option>
                  </select>
                </label>
                <label class="switch">
                  <input checked="" id="toggle-autobackup" type="checkbox" />
                  <span>Auto Backup on Close</span>
                </label>
                <label class="switch">
                  <input checked="" id="toggle-advanced-mode" type="checkbox" />
                  <span>Advanced Mode</span>
                </label>
                <div class="field-group" id="home-view-preference">
                  <label>Home view (Advanced mode)</label>
                  <div class="row" style="gap:12px;align-items:center;" data-home-view-options>
                    <label>
                      <input checked="" id="home-view-dashboard" name="home-view" type="radio" value="dashboard" />
                      Dashboard
                    </label>
                    <label>
                      <input id="home-view-labs" name="home-view" type="radio" value="labs" />
                      Dashboard (Preview)
                    </label>
                  </div>
                  <p class="muted fine-print" id="home-view-note" style="margin-top:6px;">Applies only to Advanced mode.
                    Simple mode always opens Dashboard (Preview).</p>
                </div>
                <p class="muted fine-print" style="margin-top:8px;">
                  Simple mode hides rarely-used fields and advanced features for a cleaner interface.
                </p>
              </div>
              <div class="card">
                <h3>Maintenance</h3>
                <p class="widget-summary muted">Housekeeping actions that affect the entire workspace.</p>
                <button class="btn danger" id="btn-delete-all">Delete All Local Data</button>
                <div class="row" style="margin-top:8px;gap:8px">
                  <button class="btn" id="btn-load-demo">Load Demo Data</button>
                  <button class="btn" id="btn-run-qa">Run QA Sweep</button>
                </div>
              </div>
              <div class="card">
                <h3>QA Panel</h3>
                <p class="widget-summary muted">View diagnostics produced by the self-test suite.</p>
                <div class="muted" id="qa-output">‚Äî</div>
              </div>
            </div>
          </section>
          <section class="settings-panel" data-panel="data">
            <header class="panel-head">
              <h2>Data Tools</h2>
              <p class="muted">Inspect health of imported extras and manage workspace snapshots.</p>
              <p class="muted fine-print">If the app won‚Äôt load, try Safe Mode: add ?safe=1 to the URL.</p>
            </header>
            <div class="settings-panel-grid">
              <div class="card">
                <h3>Data Health</h3>
                <p class="widget-summary muted">Quick look at detected extras after an import.</p>
                <div class="muted" id="extras-registry">Extras registry will appear after an import.</div>
              </div>
              <div class="card" id="local-utilities-card">
                <h3>Local Utilities</h3>
                <p class="widget-summary muted">Run imports, exports, demo seeds, and diagnostics without leaving your
                  browser.</p>
                <div class="local-utilities-grid">
                  <section class="utility-block">
                    <h4>Workspace Snapshots</h4>
                    <p class="muted fine-print">Create a full backup or load a snapshot generated by THE CRM Tool.</p>
                    <div class="utility-row">
                      <button class="btn brand" id="btn-export-json">Export Workspace</button>
                      <button class="btn warn" id="btn-import-json">Import Workspace</button>
                    </div>
                    <p class="muted fine-print">Imports support merge or replace modes and overwrite only when you
                      confirm.</p>
                  </section>
                  <section class="utility-block">
                    <h4>Productivity Helpers</h4>
                    <div class="utility-grid">
                      <button class="btn brand" id="btn-csv-import">CSV Import</button>
                      <button class="btn" id="btn-selftest">Self-Test</button>
                      <button class="btn" id="btn-export-ics-dashboard">Export Dashboard .ics</button>
                    </div>
                    <form class="seed-demo-form" id="seed-demo-form" style="margin-top:12px;display:grid;gap:12px">
                      <h5 class="muted" style="margin:0">Seed Demo Data</h5>
                      <div class="grid cols-2" style="gap:12px">
                        <label>
                          Count
                          <input id="seed-count" min="1" value="60" type="number" />
                        </label>
                        <label class="switch" style="margin-top:18px">
                          <input checked="" id="seed-include-tasks" type="checkbox" />
                          <span>Include tasks &amp; deadlines</span>
                        </label>
                      </div>
                      <div class="grid cols-2" style="gap:6px 16px;margin-bottom:12px">
                        <label class="switch">
                          <input checked="" id="seed-include-meetings" type="checkbox" />
                          <span>Include meetings &amp; calls</span>
                        </label>
                        <label class="switch">
                          <input checked="" id="seed-include-celebrations" type="checkbox" />
                          <span>Include birthdays &amp; anniversaries</span>
                        </label>
                      </div>
                      <fieldset style="border:1px solid var(--border-subtle, #d9d9d9);border-radius:8px;padding:12px">
                        <legend class="muted" style="font-size:0.85rem;padding:0 6px">Stages</legend>
                        <div class="grid cols-2" style="gap:6px 16px">
                          <label><input checked="" name="seed-stage" type="checkbox" value="application" />
                            Application</label>
                          <label><input checked="" name="seed-stage" type="checkbox" value="preapproved" />
                            Pre-Approved</label>
                          <label><input checked="" name="seed-stage" type="checkbox" value="processing" />
                            Processing</label>
                          <label><input checked="" name="seed-stage" type="checkbox" value="underwriting" />
                            Underwriting</label>
                          <label><input checked="" name="seed-stage" type="checkbox" value="approved" />
                            Approved</label>
                          <label><input checked="" name="seed-stage" type="checkbox" value="cleared-to-close" /> <abbr
                              title="Cleared to Close">CTC</abbr></label>
                          <label><input checked="" name="seed-stage" type="checkbox" value="funded" /> Funded</label>
                        </div>
                      </fieldset>
                      <fieldset style="border:1px solid var(--border-subtle, #d9d9d9);border-radius:8px;padding:12px">
                        <legend class="muted" style="font-size:0.85rem;padding:0 6px">Loan Types</legend>
                        <div class="grid cols-2" style="gap:6px 16px">
                          <label><input checked="" name="seed-loan" type="checkbox" value="Conventional" />
                            Conventional</label>
                          <label><input checked="" name="seed-loan" type="checkbox" value="FHA" /> FHA</label>
                          <label><input checked="" name="seed-loan" type="checkbox" value="VA" /> VA</label>
                          <label><input checked="" name="seed-loan" type="checkbox" value="Jumbo" /> Jumbo</label>
                        </div>
                      </fieldset>
                      <fieldset style="border:1px solid var(--border-subtle, #d9d9d9);border-radius:8px;padding:12px">
                        <legend class="muted" style="font-size:0.85rem;padding:0 6px">Partner Assignments</legend>
                        <div class="grid cols-2" style="gap:6px 16px">
                          <label><input checked="" id="seed-partner-buyer" type="checkbox" /> Include buyer
                            partners</label>
                          <label><input checked="" id="seed-partner-listing" type="checkbox" /> Include listing
                            partners</label>
                        </div>
                        <p class="muted fine-print" style="margin-top:8px">Unselected partner roles default to None.</p>
                      </fieldset>
                      <div class="row" style="justify-content:flex-end; gap:8px">
                        <button class="btn" id="btn-seed-full-workflow" type="button">Seed Full Workflow
                          Dataset</button>
                        <button class="btn brand" id="btn-seed-data" type="submit">Seed Demo Data</button>
                      </div>
                    </form>
                  </section>
                  <section class="utility-block">
                    <h4>Blank Templates</h4>
                    <div class="row utility-template-row">
                      <label class="muted" for="csv-template-kind" style="margin:0">Blank CSV Template</label>
                      <select id="csv-template-kind">
                        <option value="contacts">Contacts</option>
                        <option value="partners">Partners</option>
                      </select>
                      <button class="btn" id="btn-download-csv-template">Download</button>
                    </div>
                  </section>
                </div>
              </div>
            </div>
          </section>
          <section class="settings-panel" data-panel="automation">
            <header class="panel-head">
              <h2>Email Draft Prompts</h2>
              <p class="muted">Creates an email draft for you to review and send. Checks run only while this app is
                open.</p>
            </header>
            <div class="settings-panel-grid" id="settings-automation-grid"></div>
          </section>
          <section class="settings-panel" data-panel="dashboard">
            <header class="panel-head">
              <h2>Dashboard</h2>
              <p class="muted">Choose which widgets appear when viewing the full dashboard.</p>
            </header>
            <div class="settings-panel-grid">
              <div class="card">
                <h3>Widget Visibility</h3>
                <p class="widget-summary muted">Toggle sections on or off for the All view.</p>
                <div class="settings-toggle-list" id="dashboard-widget-list"></div>
              </div>
              <div class="card">
                <h3>Focus Mode</h3>
                <p class="widget-summary muted">Switch between Today and All directly from the dashboard header. Your
                  last choice is saved on this device.</p>
              </div>
            </div>
          </section>
          <section class="settings-panel" data-panel="goals">
            <header class="panel-head">
              <h2>Goals</h2>
              <p class="muted">Set the production targets that power the dashboard goal tracker.</p>
            </header>
            <div class="settings-panel-grid">
              <section class="card" id="goal-settings-card">
                <div class="row" style="justify-content:space-between;align-items:center">
                  <strong>Dashboard Goals</strong>
                  <button class="btn brand" id="btn-goals-save">Save Goals</button>
                </div>
                <p class="widget-summary muted">Track monthly progress toward funded loans and volume targets.</p>
                <div class="grid cols-2" style="margin-top:8px">
                  <label>
                    Monthly Funded Loans Goal
                    <input id="goal-funded" min="0" placeholder="e.g., 12" type="number" />
                  </label>
                  <label>
                    Monthly Loan Volume Goal ($)
                    <input id="goal-volume" min="0" placeholder="e.g., 2500000" type="number" />
                  </label>
                </div>
                <p class="muted" style="margin-top:8px">Goals reset each month and update the dashboard widget instantly
                  after saving.</p>
              </section>
            </div>
          </section>
          <section class="settings-panel" data-panel="profile">
            <header class="panel-head">
              <h2>Profile</h2>
              <p class="muted">Keep your contact details in sync for mail merges and outreach.</p>
            </header>
            <div class="settings-panel-grid">
              <section class="card" id="lo-profile-settings">
                <div class="row" style="justify-content:space-between;align-items:center">
                  <strong>Loan Officer Profile</strong>
                  <button class="btn" id="btn-lo-save">Save</button>
                </div>
                <p class="widget-summary muted">These values power templates, emails, and shared signatures.</p>
                <div class="grid cols-2" style="margin-top:8px">
                  <label>
                    Name
                    <input id="lo-name" placeholder="e.g., Alex Morgan" />
                  </label>
                  <label>
                    Email
                    <input id="lo-email" placeholder="e.g., alex@lender.com" />
                  </label>
                  <label>
                    Phone
                    <input id="lo-phone" placeholder="e.g., (555) 123-4567" />
                  </label>
                  <label>
                    Signature
                    <textarea id="lo-signature" placeholder="Footer / signature block" rows="3"></textarea>
                  </label>
                  <label>
                    Photo
                    <input accept="image/*" id="lo-photo" type="file" />
                    <span class="fine-print muted">Up to 6 MB, stored locally for this demo.</span>
                    <div class="row" style="align-items:center;gap:10px;margin-top:8px">
                      <img alt="" id="lo-photo-preview"
                        style="width:48px;height:48px;border-radius:50%;object-fit:cover;display:none" />
                      <span class="muted fine-print" id="lo-photo-empty">No photo selected</span>
                      <button class="btn danger" id="btn-lo-photo-clear" type="button">Remove</button>
                    </div>
                  </label>
                </div>
              </section>
            </div>
          </section>
          <section class="settings-panel" data-panel="signatures">
            <header class="panel-head">
              <h2>Signatures</h2>
              <p class="muted">Manage reusable sign-offs for messaging templates.</p>
            </header>
            <div class="settings-panel-grid">
              <section class="card" id="signatures-editor">
                <div class="row" style="justify-content:space-between;align-items:center">
                  <strong>Signatures</strong>
                  <div>
                    <button class="btn" id="btn-sig-add">Add</button>
                  </div>
                </div>
                <p class="widget-summary muted">Store multiple signatures and choose a default per channel.</p>
                <table class="table" id="sig-table">
                  <thead>
                    <tr>
                      <th style="width:34px">Default</th>
                      <th style="width:180px">Title</th>
                      <th>Signature Body</th>
                      <th style="width:160px">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
                <div class="muted" style="margin-top:6px">Placeholders supported: {loName} {loEmail} {loPhone}</div>
              </section>
            </div>
          </section>
        </div>
      </div>
      <dialog id="template-editor">
        <div class="dlg">
          <div class="row" style="align-items:center">
            <h3 id="tmpl-title" style="margin:0">Template</h3>
            <span class="grow"></span>
            <button class="btn" id="btn-tmpl-close">Close</button>
          </div>
          <div class="grid cols-2" style="margin-top:10px">
            <div>
              <label>
                Name
                <input id="tmpl-name" />
              </label>
            </div>
            <div>
              <label>
                Loan Type
                <select id="tmpl-loanType">
                  <option>Conventional</option>
                  <option>FHA</option>
                  <option>VA</option>
                  <option>Jumbo</option>
                  <option>USDA</option>
                </select>
              </label>
            </div>
            <div class="grid cols-2" style="grid-template-columns:repeat(4,minmax(0,1fr));gap:6px">
              <div class="muted" style="grid-column:span 4">Insert tokens</div>
              <button class="btn pill" data-token="{first}">{first}</button>
              <button class="btn pill" data-token="{last}">{last}</button>
              <button class="btn pill" data-token="{loanType}">{loanType}</button>
              <button class="btn pill" data-token="{amount}">{amount}</button>
              <button class="btn pill" data-token="{closeDate}">{closeDate}</button>
              <button class="btn pill" data-token="{due}">{due}</button>
              <button class="btn pill" data-token="{missingDocs}">{missingDocs}</button>
              <button class="btn pill" data-token="{partnerName}">{partnerName}</button>
              <span class="muted" style="margin-left:8px">Also supports {{double‚Äëbraces}}</span>
            </div>
            <!-- textarea id moved after palette for insertion handling -->
            <textarea id="tmpl-body" placeholder="Hi {first}, we still need: {missingDocs}..."></textarea>
          </div>
          <div class="row" style="justify-content:flex-end;gap:8px;margin-top:12px">
            <button class="btn danger" id="btn-tmpl-delete">Delete</button>
            <button class="btn brand" id="btn-tmpl-save">Save</button>
          </div>
        </div>
      </dialog>
      <aside class="legend" id="calendar-legend-secondary"></aside>
    </main>
    </main>
  </div>
  <!-- Floating Action Bar -->
  <div class="actionbar" data-ui="action-bar" id="actionbar">
    <div class="container actionbar-shell">
      <div class="actionbar-meta">
        <div class="actionbar-count" data-role="count">
          No records selected
        </div>
        <div class="actionbar-breakdown" data-role="breakdown">
          Select rows to unlock pipeline actions.
        </div>
        <div class="actionbar-metric" data-role="amount">
        </div>
      </div>
      <div class="actionbar-stages" data-role="stages">
      </div>
      <div class="actionbar-names" data-role="names">
        No contacts or partners in focus yet.
      </div>
      <div class="actionbar-actions">
        <button class="btn" data-act="edit" aria-label="Edit selected records" title="Edit selected records">
          Edit
        </button>
        <button class="btn" data-act="merge" aria-label="Merge selected records" title="Merge selected records">
          Merge (2)
        </button>
        <button class="btn" data-act="emailTogether" aria-label="Email selected contacts together"
          title="Email selected contacts together">
          Email Together
        </button>
        <button class="btn" data-act="emailMass" aria-label="Start mass email copy" title="Start mass email copy">
          Email Mass (copy)
        </button>
        <button class="btn" data-act="task" aria-label="Add task for selected records"
          title="Add task for selected records">
          Add Task
        </button>
        <button class="btn" data-act="bulkLog" aria-label="Bulk log activity" title="Bulk log activity">
          Bulk Log
        </button>
        <button class="btn" data-act="clear" aria-label="Clear current selection" title="Clear current selection">
          Clear
        </button>
        <button class="btn danger" data-act="delete" aria-label="Delete selected records"
          title="Delete selected records">
          Delete
        </button>
      </div>
      <div aria-live="polite" class="actionbar-busy" data-role="busy" hidden>
        <span aria-hidden="true" class="ui-spinner"></span>
        <span class="busy-text" data-role="busy-label">Working‚Ä¶</span>
      </div>
    </div>
  </div>
  <!-- Partner Modal -->
  <div class="record-modal modal partner-edit-modal hidden" data-ui="partner-edit-modal" id="partner-modal"
    aria-hidden="true" role="dialog" style="display:none">
    <div class="dlg" tabindex="-1">
      <form class="modal-form-shell" id="partner-form">
        <div class="modal-header partner-header">
          <div class="modal-title-stack grow">
            <div class="modal-title-row">
              <h3 class="modal-title" id="partner-title" data-role="record-name-text">
                Add / Edit Partner
              </h3>
              <div class="modal-header-actions" data-role="partner-header-actions"></div>
            </div>
            <div class="modal-title-sub">
              <span class="summary-chip" id="p-title-tier"></span>
              <span class="summary-chip" id="p-title-type"></span>
            </div>
          </div>
          <button class="btn ghost" data-close-partner="" type="button">
            Close
          </button>
        </div>
        <div class="dialog-scroll">
          <div class="modal-body">
            <div class="modal-form-layout">
              <aside class="modal-summary" id="partner-summary">
                <div class="identity-header" id="p-summary-name" data-role="favorite-host" data-favorite-type="partner"
                  data-record-id="">
                  <div class="identity-primary" data-role="record-nameplate" data-record-type="partner">
                    <span aria-hidden="true" class="summary-avatar is-empty" data-initials="?"
                      data-role="summary-avatar"></span>
                    <span data-role="record-name-text">New Partner</span>
                    <span class="summary-actions" data-role="favorite-actions"></span>
                  </div>
                  <div class="identity-secondary">
                    <span hidden data-role="record-name-subtext">Developing ‚Ä¢ Realtor Partner</span>
                    <span class="summary-chip" id="p-summary-tier">
                      Tier ‚Äî Developing
                    </span>
                    <span class="sep">‚Ä¢</span>
                    <span class="summary-chip" id="p-summary-type">
                      Realtor Partner
                    </span>
                  </div>
                </div>
                <div class="summary-metrics">
                  <div class="summary-metric">
                    <span class="metric-label">
                      Primary Focus
                    </span>
                    <span class="metric-value" id="p-summary-focus">
                      ‚Äî
                    </span>
                  </div>
                  <div class="summary-metric">
                    <span class="metric-label">
                      Cadence
                    </span>
                    <span class="metric-value" id="p-summary-cadence">
                      ‚Äî
                    </span>
                  </div>
                  <div class="summary-metric">
                    <span class="metric-label">
                      Active Borrowers
                    </span>
                    <span class="metric-value" id="p-summary-linked">
                      ‚Äî
                    </span>
                  </div>
                </div>
                <div class="modal-note" id="p-summary-note">
                  Keep this partner nurtured with intentional follow-up and co-branded touchpoints.
                </div>
              </aside>
              <div class="modal-main">

                <nav class="modal-tabs" id="partner-tabs">
                  <button class="btn active" data-panel="overview" type="button">Overview</button>
                  <button class="btn" data-panel="contact" type="button">Contact</button>
                  <button class="btn" data-panel="alignment" type="button">Engagement</button>
                  <button class="btn" data-panel="linked" type="button">Linked Customers</button>
                </nav>
                <div class="modal-panels">
                  <section class="modal-section modal-panel partner-panel active" data-panel="overview">
                    <h4>
                      Relationship Overview
                    </h4>
                    <div class="field-grid cols-2">
                      <label data-required="true">
                        Partner Name
                        <input aria-required="true" id="p-name" placeholder="Full name" />
                      </label>
                      <label>
                        Company / Team
                        <input id="p-company" placeholder="Brand or affiliation" />
                      </label>
                      <label>
                        Partner Type
                        <select id="p-type">
                          <option value="Realtor Partner">Realtor Partner</option>
                          <option value="Builder">Builder</option>
                          <option value="Financial Advisor">Financial Advisor</option>
                          <option value="CPA">CPA</option>
                          <option value="Attorney">Attorney</option>
                          <option value="Insurance">Insurance</option>
                          <option value="Home Services">Home Services</option>
                          <option value="Other">Other</option>
                        </select>
                      </label>
                      <label>
                        Tier
                        <select id="p-tier">
                          <option value="Top">Top</option>
                          <option value="Core">Core</option>
                          <option value="Developing">Developing</option>
                          <option value="Keep in Touch">Keep in Touch</option>
                        </select>
                      </label>
                      <label>
                        Primary Market Focus
                        <select id="p-focus">
                          <option value="Purchase">Purchase</option>
                          <option value="Listing">Listing</option>
                          <option value="First-Time Buyers">First-Time Buyers</option>
                          <option value="Move-Up Buyers">Move-Up Buyers</option>
                          <option value="Luxury">Luxury</option>
                          <option value="Investors">Investors</option>
                          <option value="New Construction">New Construction</option>
                          <option value="Referral Network">Referral Network</option>
                        </select>
                      </label>
                      <label>
                        Relationship Priority
                        <select id="p-priority">
                          <option value="Strategic">Strategic</option>
                          <option value="Core">Core</option>
                          <option value="Emerging">Emerging</option>
                          <option value="Watchlist">Watchlist</option>
                        </select>
                      </label>
                    </div>
                  </section>
                  <section class="modal-section modal-panel partner-panel" data-panel="contact">
                    <h4>
                      Contact Details
                    </h4>
                    <div class="field-grid cols-2">
                      <label data-required="true">
                        Email
                        <input aria-required="true" id="p-email" placeholder="name@company.com" type="email" />
                      </label>
                      <label data-required="true">
                        Mobile / Direct Line
                        <input aria-required="true" id="p-phone" placeholder="(555) 000-0000" type="tel" />
                      </label>
                      <label>
                        Preferred Contact Method
                        <select id="p-pref">
                          <option value="Phone">Phone</option>
                          <option value="Text">Text</option>
                          <option value="Email">Email</option>
                          <option value="Video">Video Call</option>
                          <option value="In Person">In Person</option>
                        </select>
                      </label>
                      <label>
                        Communication Cadence
                        <select id="p-cadence">
                          <option value="Weekly">Weekly</option>
                          <option value="Bi-Weekly">Bi-Weekly</option>
                          <option value="Monthly">Monthly</option>
                          <option value="Quarterly">Quarterly</option>
                          <option value="As Needed">As Needed</option>
                        </select>
                      </label>
                    </div>
                    <div class="field-grid cols-2" style="margin-top:12px">
                      <label>
                        Office Address
                        <input id="p-address" placeholder="Street" />
                      </label>
                      <label>
                        City
                        <input id="p-city" placeholder="City" />
                      </label>
                      <label>
                        State
                        <select id="p-state"></select>
                      </label>
                      <label>
                        ZIP
                        <input id="p-zip" placeholder="Postal" />
                      </label>
                    </div>
                  </section>
                  <section class="modal-section modal-panel partner-panel" data-panel="alignment">
                    <h4>
                      Pipeline Alignment
                    </h4>
                    <div class="field-grid cols-3">
                      <label>
                        Referral Volume
                        <select id="p-volume">
                          <option value="1-2 / quarter">1-2 / quarter</option>
                          <option value="1-2 / month">1-2 / month</option>
                          <option value="3-5 / month">3-5 / month</option>
                          <option value="6+ / month">6+ / month</option>
                          <option value="Project-Based">Project-Based</option>
                        </select>
                      </label>
                      <label>
                        Last Touch
                        <input id="p-lasttouch" type="date" />
                      </label>
                      <label>
                        Next Planned Touch
                        <input id="p-nexttouch" type="date" />
                      </label>
                    </div>
                    <div class="field-grid cols-2" style="margin-top:12px">
                      <label>
                        Relationship Owner
                        <input id="p-owner" placeholder="Primary LO or team member" />
                      </label>
                      <label>
                        Collaboration Focus
                        <select id="p-collab">
                          <option value="Open Houses">Open Houses</option>
                          <option value="Buyer Education">Buyer Education</option>
                          <option value="Co-Marketing">Co-Marketing</option>
                          <option value="Events">Events</option>
                          <option value="Digital Campaigns">Digital Campaigns</option>
                          <option value="Lead Sharing">Lead Sharing</option>
                          <option value="New Construction">New Construction</option>
                          <option value="Other">Other</option>
                        </select>
                      </label>
                    </div>
                    <label class="section-subhead" style="margin-top:14px">
                      Success Plan & Notes
                    </label>
                    <textarea id="p-notes"
                      placeholder="Outline co-marketing plans, event commitments, and next steps."></textarea>
                  </section>
                  <section class="modal-section modal-panel partner-panel" data-panel="linked">
                    <h4>
                      Linked Customers
                    </h4>
                    <div class="linked-summary muted" id="partner-linked-summary">
                      No linked customers yet.
                    </div>
                    <div class="linked-customers" id="partner-linked">
                      <div class="linked-empty muted">
                        Save activity with this partner to see connected borrowers and deals.
                      </div>
                    </div>
                  </section>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer" data-form-footer="partner">
          <button class="btn" data-close type="button">
            Cancel
          </button>
          <button class="btn brand" id="p-save" type="button">
            Save Partner
          </button>
        </div>
      </form>
    </div>
  </div>
  <!-- Contact Modal placeholder -->
  <dialog class="record-modal" id="contact-modal" style="display:none">
    <div class="dlg" tabindex="-1">
      <form class="modal-form-shell" id="contact-form" method="dialog">
        <div class="modal-header contact-header">
          <div class="modal-title-stack grow">
            <div class="modal-title-row">
              <h3 class="modal-title" data-role="record-name-text">
                Add / Edit Contact
              </h3>
              <div class="modal-header-actions" data-role="contact-header-actions"></div>
            </div>
            <div class="modal-title-sub">
              <span data-role="stage-chip-wrapper"></span>
              <span class="status-pill" data-role="status-pill"></span>
            </div>
          </div>
          <button class="btn ghost" data-close="" type="button">
            Close
          </button>
        </div>
        <div class="dialog-scroll">
          <div class="modal-body" id="contact-modal-body">
          </div>
        </div>
        <div class="modal-footer" data-form-footer="contact">
          <button class="btn" data-close type="button">
            Cancel
          </button>
          <button class="btn brand" id="btn-save-contact" type="button" value="default">
            Save Contact
          </button>
        </div>
      </form>
    </div>
  </dialog>
  <template id="contact-editor-template">
    <input type="hidden" id="c-id" value="">
    <input type="hidden" id="c-lastname" value="">
    <div class="modal-form-layout">
      <aside class="modal-summary">
        <div class="summary-meta" data-role="favorite-host" data-favorite-type="contact" data-record-id="">
          <div class="identity-primary" data-role="record-nameplate" data-record-type="contact">
            <span data-role="record-name-text">New Contact</span>
            <span class="summary-actions" data-role="favorite-actions"></span>
          </div>
          <div class="identity-secondary">
            <span hidden data-role="record-name-subtext">Application ‚Ä¢ In Progress</span>
            <span class="summary-chip" data-role="stage-chip-wrapper" hidden></span>
            <span class="status-pill" data-role="status-pill" hidden></span>
          </div>
        </div>

        <div class="summary-metrics">
          <div class="summary-metric">
            <span class="metric-label">Loan Program</span>
            <span class="metric-value" id="c-summary-program"></span>
          </div>
          <div class="summary-metric">
            <span class="metric-label">Loan Amount</span>
            <span class="metric-value" id="c-summary-amount"></span>
          </div>
          <div class="summary-metric">
            <span class="metric-label">Next Touch</span>
            <span class="metric-value" id="c-summary-touch"></span>
          </div>
          <div class="summary-metric">
            <span class="metric-label">Lead Source</span>
            <span class="metric-value" id="c-summary-source"></span>
          </div>
          <div class="summary-metric">
            <span class="metric-label">Referral Partner</span>
            <span class="metric-value" id="c-summary-referral"></span>
          </div>
        </div>
        <div class="modal-note" id="c-summary-note">
          Keep momentum with timely follow-up, clear milestones, and aligned partner updates.
        </div>
      </aside>
      <div class="modal-main">
        <div class="modal-core">

          <section class="milestone-header" data-role="milestone-header">
            <div class="milestone-header-top">
              <div class="milestone-progress" role="progressbar" aria-label="Pipeline milestone progress"
                aria-valuemin="1" aria-valuemax="" aria-valuenow="1" data-role="milestone-progress"
                data-qa="milestone-bar">
                <div class="milestone-progress-fill" data-role="milestone-progress-fill"></div>
              </div>
              <button class="btn ghost compact" type="button" data-role="milestone-next" data-qa="milestone-next">Log
                Next Step</button>
            </div>
            <div class="milestone-badges" role="group" aria-label="Milestone badges">
            </div>
          </section>
          <div class="modal-content">
            <nav class="modal-tabs" id="contact-tabs">
              <button class="btn active" data-panel="profile" type="button">Profile</button>
              <button class="btn" data-panel="loan" type="button">Loan &amp; Property</button>
              <button class="btn" data-panel="relationships" type="button">Relationships</button>
              <button class="btn" data-panel="docs" type="button">Document Checklist</button>
            </nav>
            <div class="modal-panels">
              <section class="modal-section modal-panel active" data-panel="profile">
                <h4>Borrower Profile</h4>
                <div class="field-grid cols-2">
                  <label data-required="true">First Name<input aria-required="true" id="c-first" value=""></label>
                  <label data-required="true">Last Name<input aria-required="true" id="c-last" value=""></label>
                  <label>Contact Role<select id="c-type"></select></label>
                  <label>Priority<select id="c-priority"></select></label>
                  <label>Lead Source<select id="c-source">
                      <option value="">Select source</option>
                    </select></label>
                  <label>Communication Preference<select id="c-pref"></select></label>
                  <label data-required="true">Primary Email<input aria-required="true" id="c-email" type="email"
                      value=""></label>
                  <label data-required="true">Mobile / Direct Line<input aria-required="true" id="c-phone" type="tel"
                      value=""></label>
                  <label data-advanced="contact">Secondary Email<input id="c-email2" type="email" value=""></label>
                  <label data-advanced="contact">Secondary Phone<input id="c-phone2" type="tel" value=""></label>
                </div>
              </section>
              <section class="modal-section modal-panel" data-panel="loan">
                <h4>Pipeline Stage</h4>
                <div class="stage-slider" id="contact-stage-slider">
                  <div class="stage-slider-track">
                    <div class="stage-slider-progress" id="contact-stage-progress"></div>
                    <div class="stage-slider-marks"></div>
                  </div>
                  <div class="stage-slider-labels"></div>
                  <input type="range" min="0" max="" step="1" value="0" id="contact-stage-range"
                    aria-label="Pipeline stage slider">
                  <div class="stage-slider-help" id="contact-stage-help">
                    <!-- Audit 2025-10-06: Wording already clarifies manual email drafts; no auto-send implied. -->
                    <strong id="contact-stage-help-title">Email Draft Prompts</strong>
                    <p id="contact-stage-helptext">Stage changes queue email prompts for you to review and send
                      alongside partner notifications and task updates.</p>
                  </div>
                </div>
                <div style="margin-top:18px">
                  <h4>Property &amp; Loan Snapshot</h4>
                  <div class="field-grid cols-3">
                    <label data-required="true">Stage<select aria-required="true" id="c-stage"></select></label>
                    <label data-required="true">Status<select aria-required="true" id="c-status"></select></label>
                    <label data-advanced="loan">Closing Timeline<select id="c-timeline"></select></label>
                    <label data-advanced="loan">Loan Purpose<select id="c-purpose"></select></label>
                    <label data-advanced="loan">Loan Program<select id="c-loanType"></select></label>
                    <label data-advanced="loan">Property Type<select id="c-property"></select></label>
                    <label data-advanced="loan">Occupancy<select id="c-occupancy"></select></label>
                    <label data-advanced="loan">Employment Type<select id="c-employment"></select></label>
                    <label data-advanced="loan">Credit Range<select id="c-credit"></select></label>
                  </div>
                  <div class="field-grid cols-3" style="margin-top:12px">
                    <label data-advanced="loan">Loan Amount<input id="c-amount" type="number" value=""></label>
                    <label data-advanced="loan">Rate<input id="c-rate" type="number" step="0.001" value=""></label>
                    <label data-advanced="loan">Funded / Expected Closing<input id="c-funded" type="date"
                        value=""></label>
                    <label data-advanced="loan">Pre-Approval Expires<input id="c-preexp" type="date" value=""></label>
                    <label data-advanced="loan">Documentation Stage<select id="c-docstage"></select></label>
                    <label data-advanced="loan">Pipeline Milestone<select id="c-milestone"></select></label>
                  </div>
                </div>
                <div style="margin-top:18px">
                  <h4>Property Address</h4>
                  <div class="field-grid cols-2">
                    <label>Street Address<input id="c-address" value=""></label>
                    <label>City<input id="c-city" value=""></label>
                    <label>State<select id="c-state"></select></label>
                    <label>ZIP<input id="c-zip" value=""></label>
                  </div>
                </div>
              </section>
              <section class="modal-section modal-panel" data-panel="relationships">
                <h4>Relationships &amp; Follow-Up</h4>
                <div class="field-grid cols-2">
                  <label data-advanced="relationships">Buyer Partner<select id="c-buyer">
                      <option value="">Select partner</option>
                    </select></label>
                  <label data-advanced="relationships">Listing Partner<select id="c-listing">
                      <option value="">Select partner</option>
                    </select></label>
                  <label data-advanced="relationships">Referral Partner<select id="c-referral-partner">
                      <option value="">Select partner</option>
                    </select></label>
                  <label data-advanced="relationships">Referred By<select id="c-ref">
                      <option value="">Select source</option>
                    </select></label>
                  <label data-advanced="relationships">Last Contact<input id="c-lastcontact" type="date"
                      value=""></label>
                  <label data-advanced="relationships">Next Follow-Up<input id="c-nexttouch" type="date"
                      value=""></label>
                </div>
                <label class="section-subhead" style="margin-top:14px">Conversation Notes</label>
                <textarea id="c-notes"></textarea>
              </section>
              <section class="modal-section modal-panel" data-panel="docs" data-simple-advanced-only="docs">
                <h4>Document Checklist</h4>
                <div class="doc-automation-grid">
                  <div class="doc-automation-summary">
                    <div class="muted" id="c-doc-summary">Select a loan program to generate the checklist.</div>
                    <div class="doc-missing" id="c-doc-missing"></div>
                    <ul class="doc-chip-list" id="c-doc-list"></ul>
                  </div>
                  <div class="doc-automation-actions">
                    <button class="btn" type="button" id="c-sync-docs">Sync Required Docs</button>
                    <button class="btn brand" type="button" id="c-email-docs">Email Document Request</button>
                  </div>
                </div>
              </section>
            </div>
          </div>
        </div>
        <aside class="modal-aside" data-ui="contact-detail-pane">
          <section class="detail-card" data-role="contact-detail-overview">
            <h4>Contact Snapshot</h4>
            <dl class="detail-list">
              <div class="detail-list-row">
                <dt>Stage</dt>
                <dd id="c-detail-stage"></dd>
              </div>
              <div class="detail-list-row">
                <dt>Status</dt>
                <dd id="c-detail-status"></dd>
              </div>
              <div class="detail-list-row">
                <dt>Last Touch</dt>
                <dd id="c-detail-last"></dd>
              </div>
              <div class="detail-list-row">
                <dt>Next Follow-Up</dt>
                <dd id="c-detail-next"></dd>
              </div>
            </dl>
          </section>
          <section class="detail-card" data-role="contact-detail-highlights">
            <h4>Key Details</h4>
            <dl class="detail-list">
              <div class="detail-list-row">
                <dt>Loan Program</dt>
                <dd id="c-detail-program"></dd>
              </div>
              <div class="detail-list-row">
                <dt>Loan Amount</dt>
                <dd id="c-detail-amount"></dd>
              </div>
              <div class="detail-list-row">
                <dt>Lead Source</dt>
                <dd id="c-detail-source"></dd>
              </div>
              <div class="detail-list-row">
                <dt>Referral Partner</dt>
                <dd id="c-detail-referral"></dd>
              </div>
            </dl>
          </section>
        </aside>
      </div>
    </div>
  </template>
  <div class="toast" id="toast">
  </div>
  <!-- Filters Modal (Phase 7) -->
  <dialog id="import-workspace-dialog">
    <div class="dlg import-dialog">
      <div class="row" style="align-items:center">
        <h3 style="margin:0">Import Workspace</h3>
        <span class="grow"></span>
        <button class="btn" id="import-dialog-close" type="button">Close</button>
      </div>
      <p class="muted">Load a JSON snapshot created by THE CRM Tool and decide whether to merge with or replace existing
        records.</p>
      <fieldset class="import-mode-group">
        <legend class="muted">Restore mode</legend>
        <label class="switch">
          <input checked="" name="import-mode" type="radio" value="merge" />
          <span>Merge (keep newer local records)</span>
        </label>
        <br />
        <label class="switch">
          <input name="import-mode" type="radio" value="replace" />
          <span>Replace (wipe then load snapshot)</span>
        </label>
      </fieldset>
      <div class="import-file-row">
        <button class="btn" id="import-dialog-choose" type="button">Choose File</button>
        <span class="muted" id="import-dialog-filename">No file selected.</span>
      </div>
      <p class="muted fine-print">Snapshots stay on this device only. Large imports may take a few moments.</p>
      <input accept="application/json" class="hidden" id="import-json-input" type="file" />
      <div class="row import-dialog-footer">
        <span class="grow"></span>
        <button class="btn" id="import-dialog-cancel" type="button">Cancel</button>
        <button class="btn brand" id="import-dialog-import" type="button">Import Snapshot</button>
      </div>
    </div>
  </dialog>
  <dialog id="filters-modal">
    <div class="dlg filters-modal-shell">
      <div class="filters-header row">
        <div>
          <h3 style="margin:0">Filters</h3>
          <div class="muted" id="filters-scope-label"></div>
        </div>
        <span class="grow"></span>
        <button class="btn" id="btn-filters-close">Close</button>
      </div>
      <div class="filters-body">
        <aside class="filters-summary" id="filters-summary"></aside>
        <div class="filters-content" id="filters-content"></div>
      </div>
      <div class="row filters-footer">
        <span class="grow"></span>
        <button class="btn" id="btn-filters-clear">Clear</button>
        <button class="btn brand" id="btn-filters-apply">Apply</button>
      </div>
    </div>
  </dialog>


  <script>
    window.__APP_VERSION__ = 'v2025.09.27';
    window.__INIT_FLAGS__ = window.__INIT_FLAGS__ || {};
    window.__PATCHES_LOADED__ = [];
    try {
      const hint = new URL('./js/', document.baseURI).href;
      if (!window.__CRM_BOOT_BASE__) {
        window.__CRM_BOOT_BASE__ = hint;
      }
    } catch (_) { }
    try {
      if (!Array.isArray(window.__CRM_POST_FIRST_PAINT_MODULES__)) {
        const modules = [
          './js/ui/debug_overlay.js',
          './js/ui/universal_search.js',
          './js/table/table_export.js',
          './js/ui/help_hints.js',
          './js/ui/advanced_mode.js'
        ];
        window.__CRM_POST_FIRST_PAINT_MODULES__ = modules.map((spec) => {
          try {
            return new URL(spec, document.baseURI).href;
          } catch (_) {
            return spec;
          }
        });
      }
    } catch (_) {
      window.__CRM_POST_FIRST_PAINT_MODULES__ = [
        './js/ui/debug_overlay.js',
        './js/ui/universal_search.js',
        './js/table/table_export.js',
        './js/ui/help_hints.js',
        './js/ui/advanced_mode.js'
      ];
    }
  </script>
  <script type="module" src="./js/router/init.js"></script>
  <script type="module">
    import { ensureCoreThenPatches } from './js/boot/boot_hardener.js';
    import { CORE, PATCHES, REQUIRED } from './js/boot/manifest.js';
    ensureCoreThenPatches({ CORE, PATCHES, REQUIRED });
  </script>
</body>

</html>